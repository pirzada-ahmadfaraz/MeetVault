(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[213],{4139:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(5155),r=s(2115),n=s(63),i=s(6707),o=s(7062);function l(e){let{children:t}=e,{user:s,isLoading:l,isAuthenticated:c}=(0,i.N)(),d=(0,n.useRouter)();return((0,r.useEffect)(()=>{l||s||d.push("/auth/login")},[s,l,d]),l)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(o.A,{size:"large"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):c?(0,a.jsx)(a.Fragment,{children:t}):null}},6641:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>L});var a=s(5155),r=s(2115),n=s(63),i=s(6707),o=s(7621),l=s(4139),c=s(9829);class d{initializeSocket(){let e="https://meetvault-production.up.railway.app/api".replace("/api","");console.log("\uD83D\uDD0C WebRTC: Initializing socket connection to:",e);let t=localStorage.getItem("authToken");if(!t)return void console.error("❌ WebRTC: No auth token found");this.socket=(0,c.io)(e,{transports:["websocket","polling"],timeout:1e4,forceNew:!0,auth:{token:t}}),this.socket.on("connect",()=>{var e;console.log("\uD83D\uDCE1 WebRTC: Connected to signaling server"),console.log("\uD83C\uDD94 WebRTC: Socket ID:",null==(e=this.socket)?void 0:e.id)}),this.socket.on("connect_error",s=>{console.error("❌ WebRTC: Socket connection failed:",s),console.log("\uD83D\uDD0D WebRTC: Trying to connect to:",e),console.log("\uD83D\uDD11 WebRTC: Using token:",t?"Present":"Missing")}),this.socket.on("disconnect",e=>{console.log("\uD83D\uDCE1 WebRTC: Disconnected from signaling server. Reason:",e)}),this.socket.on("user-joined",e=>{var t;console.log("\uD83D\uDC64 WebRTC: User joined:",(null==(t=e.user)?void 0:t.firstName)||e.userId),this.handleUserJoined(e)}),this.socket.on("user-left",e=>{console.log("\uD83D\uDC4B WebRTC: User left:",e.userId),this.handleUserLeft(e.userId)}),this.socket.on("meeting-joined",e=>{var t;console.log("\uD83C\uDF89 WebRTC: Meeting joined! Found",(null==(t=e.participants)?void 0:t.length)||0,"existing participants"),e.participants&&e.participants.length>0?e.participants.forEach(e=>{var t;let s={id:e.userId.toString(),userId:e.userId.toString(),user:e.user,isHost:!1,isVideoEnabled:e.isVideoEnabled,isAudioEnabled:e.isAudioEnabled,isScreenSharing:e.isScreenSharing};console.log("➕ WebRTC: Adding existing participant:",e.user.firstName),null==(t=this.callbacks)||t.onParticipantJoined(s)}):console.log("✨ WebRTC: First participant in meeting")}),this.socket.on("user-disconnected",e=>{console.log("User disconnected:",e),this.handleUserLeft(e.userId)}),this.socket.on("offer",e=>{console.log("\uD83D\uDCDE WebRTC: Received offer from:",e.fromUserId),this.handleOffer(e)}),this.socket.on("answer",e=>{console.log("✅ WebRTC: Received answer from:",e.fromUserId),this.handleAnswer(e)}),this.socket.on("ice-candidate",e=>{console.log("\uD83E\uDDCA WebRTC: Received ICE candidate from:",e.fromUserId),this.handleIceCandidate(e)}),this.socket.on("participant-video-toggled",e=>{var t;null==(t=this.callbacks)||t.onParticipantToggleVideo(e.userId,e.isVideoEnabled)}),this.socket.on("participant-audio-toggled",e=>{var t;null==(t=this.callbacks)||t.onParticipantToggleAudio(e.userId,e.isAudioEnabled)}),this.socket.on("participant-started-screen-share",e=>{var t;console.log("\uD83D\uDDA5️ WebRTC: Participant started screen share:",e.userId),null==(t=this.callbacks)||t.onParticipantScreenShareStarted(e.userId,null)}),this.socket.on("participant-stopped-screen-share",e=>{var t;console.log("\uD83D\uDDA5️ WebRTC: Participant stopped screen share:",e.userId),null==(t=this.callbacks)||t.onParticipantScreenShareStopped(e.userId)}),this.socket.on("participant-voice-activity",e=>{var t;console.log("\uD83D\uDDE3️ WebRTC: Received voice activity:",e.userId,e.isSpeaking),null==(t=this.callbacks)||t.onParticipantVoiceActivity(e.userId,e.isSpeaking)}),this.socket.on("meeting-ended",e=>{var t;console.log("\uD83D\uDEAB WebRTC: Meeting ended by host:",e.message,e.hostName),null==(t=this.callbacks)||t.onMeetingEnded(e.message,e.hostName)}),this.socket.on("removed-from-meeting",e=>{var t,s;console.log("❌ WebRTC: Removed from meeting by host:",e.message,e.hostName),null==(s=this.callbacks)||null==(t=s.onRemovedFromMeeting)||t.call(s,e.message,e.hostName)}),this.socket.on("participant-removed",e=>{var t,s;console.log("❌ WebRTC: Participant removed:",e.participantId,"by:",e.removedBy),null==(s=this.callbacks)||null==(t=s.onParticipantRemoved)||t.call(s,e.participantId,e.removedBy)}),this.socket.on("participant-removed-success",e=>{var t,s;console.log("✅ WebRTC: Participant removal confirmed:",e.participantId),null==(s=this.callbacks)||null==(t=s.onParticipantRemovedSuccess)||t.call(s,e.participantId)}),this.socket.on("host-muted-you",e=>{var t,s;if(console.log("\uD83D\uDD07 WebRTC: Muted by host:",e.message,e.hostName),this.hostMutedState=!0,this.localStream){let e=this.localStream.getAudioTracks()[0];e&&(e.enabled=!1,this.mediaControls.audio=!1)}null==(s=this.callbacks)||null==(t=s.onHostMutedYou)||t.call(s,e.message,e.hostName)}),this.socket.on("host-unmuted-you",e=>{var t,s;if(console.log("\uD83D\uDD0A WebRTC: Unmuted by host:",e.message,e.hostName),this.hostMutedState=!1,this.localStream){let e=this.localStream.getAudioTracks()[0];e&&(e.enabled=!0,this.mediaControls.audio=!0)}null==(s=this.callbacks)||null==(t=s.onHostUnmutedYou)||t.call(s,e.message,e.hostName)}),this.socket.on("participant-muted-success",e=>{var t,s;console.log("✅ WebRTC: Participant mute confirmed:",e.participantId),null==(s=this.callbacks)||null==(t=s.onParticipantMutedSuccess)||t.call(s,e.participantId)}),this.socket.on("participant-unmuted-success",e=>{var t,s;console.log("✅ WebRTC: Participant unmute confirmed:",e.participantId),null==(s=this.callbacks)||null==(t=s.onParticipantUnmutedSuccess)||t.call(s,e.participantId)}),this.socket.on("error",e=>{var t;console.error("Socket error:",e),null==(t=this.callbacks)||t.onError(e.message||"Connection error")})}async waitForSocketConnection(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return(null==(e=this.socket)?void 0:e.connected)?(console.log("✅ WebRTC: Socket already connected"),!0):(console.log("⏳ WebRTC: Waiting for socket connection..."),new Promise(e=>{let s=setTimeout(()=>{console.error("⏰ WebRTC: Socket connection timeout"),e(!1)},t),a=()=>{var t,n;console.log("✅ WebRTC: Socket connected successfully"),clearTimeout(s),null==(t=this.socket)||t.off("connect",a),null==(n=this.socket)||n.off("connect_error",r),e(!0)},r=t=>{var n,i;console.error("❌ WebRTC: Socket connection error during wait:",t),clearTimeout(s),null==(n=this.socket)||n.off("connect",a),null==(i=this.socket)||i.off("connect_error",r),e(!1)};this.socket?(this.socket.on("connect",a),this.socket.on("connect_error",r)):(clearTimeout(s),e(!1))}))}async joinMeeting(e,t){var s,a,r;console.log("\uD83D\uDE80 WebRTC: Attempting to join meeting:",e),this.meetingId=e,this.callbacks=t;try{if(this.socket||(console.log("\uD83D\uDD27 WebRTC: Initializing socket connection..."),this.initializeSocket()),console.log("\uD83D\uDD0C WebRTC: Ensuring socket connection..."),!await this.waitForSocketConnection())return console.error("❌ WebRTC: Failed to establish socket connection"),null==(a=this.callbacks)||a.onError("Failed to connect to server. Please check your internet connection and try again."),!1;return console.log("\uD83C\uDFA5 WebRTC: Initializing camera and microphone..."),await this.initializeUserMedia(),console.log("\uD83C\uDFE0 WebRTC: Joining meeting room via socket..."),null==(s=this.socket)||s.emit("join-meeting",{meetingId:e}),console.log("✅ WebRTC: Meeting join process completed successfully"),!0}catch(t){console.error("❌ WebRTC: Failed to join meeting:",t);let e=t instanceof Error?t.message:"Failed to access camera/microphone";return null==(r=this.callbacks)||r.onError(e),!1}}async initializeUserMedia(){try{if(console.log("\uD83C\uDFA5 WebRTC: Requesting camera and microphone access..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("WebRTC is not supported in this browser");return this.localStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),console.log("✅ WebRTC: Successfully got user media stream:",this.localStream.id),this.localStream.getVideoTracks().forEach(e=>{e.enabled=this.mediaControls.video,console.log("\uD83D\uDCF9 WebRTC: Video track enabled:",e.enabled,"Label:",e.label)}),this.localStream.getAudioTracks().forEach(e=>{e.enabled=this.mediaControls.audio,console.log("\uD83C\uDFA4 WebRTC: Audio track enabled:",e.enabled,"Label:",e.label)}),this.localStream}catch(e){if(console.error("❌ WebRTC: Failed to get user media:",e),e instanceof Error){if("NotAllowedError"===e.name)throw Error("Camera/microphone access denied. Please allow permissions and refresh.");else if("NotFoundError"===e.name)throw Error("No camera or microphone found. Please check your devices.");else if("NotReadableError"===e.name)throw Error("Camera/microphone is already in use by another application.");else if("OverconstrainedError"===e.name)throw Error("Camera/microphone constraints could not be satisfied.");else if("SecurityError"===e.name)throw Error("Camera/microphone access blocked by browser security.")}throw e}}getLocalStream(){return this.localStream}isHostMuted(){return this.hostMutedState}getLocalScreenStream(){return this.localScreenStream}async toggleVideo(){if(!this.localStream)return!1;let e=this.localStream.getVideoTracks()[0];if(e){var t;e.enabled=!e.enabled,this.mediaControls.video=e.enabled,console.log("\uD83C\uDFA5 WebRTC: Video toggled to:",e.enabled),console.log("\uD83C\uDFA4 WebRTC: Audio remains:",this.mediaControls.audio);let s=this.localStream.getAudioTracks()[0];return s&&(console.log("\uD83C\uDFA4 WebRTC: Audio track enabled status:",s.enabled),s.enabled=this.mediaControls.audio),null==(t=this.socket)||t.emit("toggle-video",{meetingId:this.meetingId,isVideoEnabled:e.enabled}),e.enabled}return!1}async toggleAudio(){var e,t,s;if(!this.localStream)return!1;if(this.hostMutedState&&!this.mediaControls.audio)return null==(t=this.callbacks)||null==(e=t.onError)||e.call(t,"You have been muted by the host and cannot unmute yourself"),!1;let a=this.localStream.getAudioTracks()[0];if(a){a.enabled=!a.enabled,this.mediaControls.audio=a.enabled,console.log("\uD83C\uDFA4 WebRTC: Audio toggled to:",a.enabled),console.log("\uD83C\uDFA5 WebRTC: Video remains:",this.mediaControls.video);let e=this.localStream.getVideoTracks()[0];return e&&(console.log("\uD83C\uDFA5 WebRTC: Video track enabled status:",e.enabled),e.enabled=this.mediaControls.video),null==(s=this.socket)||s.emit("toggle-audio",{meetingId:this.meetingId,isAudioEnabled:a.enabled}),a.enabled}return!1}async toggleScreenShare(){try{var e,t;if(this.mediaControls.screenShare){if(this.localScreenStream&&(this.localScreenStream.getTracks().forEach(e=>e.stop()),this.localScreenStream=null),this.localStream){let e=this.localStream.getVideoTracks()[0];for(let[t,s]of this.peerConnections){let a=s.getSenders().find(e=>{var t;return(null==(t=e.track)?void 0:t.kind)==="video"});a&&e&&(await a.replaceTrack(e),console.log("\uD83D\uDCF9 WebRTC: Restored camera track for:",t))}}return this.mediaControls.screenShare=!1,null==(e=this.socket)||e.emit("stop-screen-share",{meetingId:this.meetingId}),!1}{this.localScreenStream=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}),this.mediaControls.screenShare=!0,this.localScreenStream.getVideoTracks()[0].addEventListener("ended",async()=>{var e,t,s;if(console.log("\uD83D\uDDA5️ WebRTC: Screen share ended by user"),this.localStream){let e=this.localStream.getVideoTracks()[0];for(let[t,s]of this.peerConnections){let a=s.getSenders().find(e=>{var t;return(null==(t=e.track)?void 0:t.kind)==="video"});a&&e&&(await a.replaceTrack(e),console.log("\uD83D\uDCF9 WebRTC: Restored camera track for:",t))}}this.mediaControls.screenShare=!1,this.localScreenStream=null,null==(e=this.socket)||e.emit("stop-screen-share",{meetingId:this.meetingId}),null==(s=this.callbacks)||null==(t=s.onParticipantScreenShareStopped)||t.call(s,"local")});let e=this.localScreenStream.getVideoTracks()[0];for(let[t,s]of this.peerConnections){let a=s.getSenders().find(e=>{var t;return(null==(t=e.track)?void 0:t.kind)==="video"});a&&e&&(await a.replaceTrack(e),console.log("\uD83D\uDDA5️ WebRTC: Replaced video track with screen share for:",t))}return null==(t=this.socket)||t.emit("start-screen-share",{meetingId:this.meetingId}),!0}}catch(e){return console.error("Screen share error:",e),!1}}async handleUserJoined(e){let{userId:t,user:s}=e;console.log("\uD83E\uDD1D WebRTC: Setting up connection with",s.firstName);try{var a,r;if(this.peerConnections.has(t))return void console.log("⚠️ WebRTC: Peer connection already exists for:",s.firstName);let e={id:t,userId:t,user:{_id:t,firstName:s.firstName,lastName:s.lastName,username:s.username,email:s.email||""},isHost:!1,isVideoEnabled:!0,isAudioEnabled:!0,isScreenSharing:!1};console.log("\uD83D\uDD17 WebRTC: Creating peer connection for new participant:",s.firstName);let n=this.createPeerConnection(t);this.peerConnections.set(t,n),this.localStream&&(this.localStream.getTracks().forEach(e=>{n.addTrack(e,this.localStream)}),console.log("\uD83D\uDCF9 WebRTC: Added local stream tracks to peer connection"));let i=await n.createOffer();await n.setLocalDescription(i),console.log("\uD83D\uDCE4 WebRTC: Sending offer to",s.firstName),null==(a=this.socket)||a.emit("offer",{meetingId:this.meetingId,targetUserId:t,offer:i}),null==(r=this.callbacks)||r.onParticipantJoined(e)}catch(e){console.error("❌ WebRTC: Error handling user joined:",s.firstName,e)}}handleUserLeft(e){var t;let s=this.peerConnections.get(e);s&&(s.close(),this.peerConnections.delete(e)),null==(t=this.callbacks)||t.onParticipantLeft(e)}async handleOffer(e){let{fromUserId:t,offer:s}=e;try{var a;if(this.peerConnections.has(t))return void console.log("⚠️ WebRTC: Peer connection already exists for offer from:",t);console.log("\uD83E\uDD1D WebRTC: Creating peer connection to handle offer from:",t);let e=this.createPeerConnection(t);this.peerConnections.set(t,e),this.localStream&&(this.localStream.getTracks().forEach(t=>{e.addTrack(t,this.localStream)}),console.log("\uD83D\uDCF9 WebRTC: Added local stream tracks to peer connection")),await e.setRemoteDescription(s),console.log("\uD83D\uDCE5 WebRTC: Set remote description from offer");let r=await e.createAnswer();await e.setLocalDescription(r),console.log("\uD83D\uDCE4 WebRTC: Sending answer back to:",t),null==(a=this.socket)||a.emit("answer",{meetingId:this.meetingId,targetUserId:t,answer:r})}catch(e){console.error("❌ WebRTC: Error handling offer from:",t,e)}}async handleAnswer(e){let{fromUserId:t,answer:s}=e;try{let e=this.peerConnections.get(t);e?(await e.setRemoteDescription(s),console.log("\uD83D\uDCE5 WebRTC: Set remote description from answer:",t)):console.error("❌ WebRTC: No peer connection found for answer from:",t)}catch(e){console.error("❌ WebRTC: Error handling answer from:",t,e)}}async handleIceCandidate(e){let{fromUserId:t,candidate:s}=e;try{let e=this.peerConnections.get(t);e&&s?(await e.addIceCandidate(s),console.log("\uD83E\uDDCA WebRTC: Added ICE candidate from:",t)):e||console.error("❌ WebRTC: No peer connection found for ICE candidate from:",t)}catch(e){console.error("❌ WebRTC: Error adding ICE candidate from:",t,e)}}createPeerConnection(e){let t=new RTCPeerConnection({iceServers:this.iceServers});return t.onicecandidate=t=>{if(t.candidate){var s;null==(s=this.socket)||s.emit("ice-candidate",{meetingId:this.meetingId,targetUserId:e,candidate:t.candidate})}},t.ontrack=t=>{var s;let[a]=t.streams;console.log("\uD83C\uDFA5 WebRTC: Received video stream from participant:",e),console.log("Stream details:",{id:a.id,videoTracks:a.getVideoTracks().length,audioTracks:a.getAudioTracks().length,active:a.active}),null==(s=this.callbacks)||s.onParticipantStreamUpdated(e,a)},t.onconnectionstatechange=()=>{console.log("\uD83D\uDD17 WebRTC: Connection state changed:",e,"->",t.connectionState),"connected"===t.connectionState?console.log("✅ WebRTC: Successfully connected to participant:",e):"failed"===t.connectionState&&console.error("❌ WebRTC: Connection failed to participant:",e)},t}leaveMeeting(){var e;this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.localScreenStream&&(this.localScreenStream.getTracks().forEach(e=>e.stop()),this.localScreenStream=null),this.peerConnections.forEach(e=>e.close()),this.peerConnections.clear(),null==(e=this.socket)||e.emit("leave-meeting",{meetingId:this.meetingId}),this.meetingId=null,this.callbacks=null}getMediaControls(){return{...this.mediaControls}}broadcastVoiceActivity(e){this.socket&&this.meetingId&&(console.log("\uD83D\uDDE3️ WebRTC: Broadcasting voice activity:",e),this.socket.emit("voice-activity",{meetingId:this.meetingId,isSpeaking:e}))}endMeeting(){this.socket&&this.meetingId&&(console.log("\uD83D\uDEAB WebRTC: Host ending meeting:",this.meetingId),this.socket.emit("end-meeting",{meetingId:this.meetingId}))}removeParticipant(e){this.socket&&this.meetingId&&(console.log("❌ WebRTC: Host removing participant:",e),this.socket.emit("remove-participant",{meetingId:this.meetingId,participantId:e}))}hostMuteParticipant(e){this.socket&&this.meetingId&&(console.log("\uD83D\uDD07 WebRTC: Host muting participant:",e),this.socket.emit("host-mute-participant",{meetingId:this.meetingId,participantId:e}))}hostUnmuteParticipant(e){this.socket&&this.meetingId&&(console.log("\uD83D\uDD0A WebRTC: Host unmuting participant:",e),this.socket.emit("host-unmute-participant",{meetingId:this.meetingId,participantId:e}))}disconnect(){var e;this.leaveMeeting(),null==(e=this.socket)||e.disconnect()}constructor(){this.socket=null,this.localStream=null,this.localScreenStream=null,this.peerConnections=new Map,this.meetingId=null,this.callbacks=null,this.mediaControls={video:!0,audio:!0,screenShare:!1},this.hostMutedState=!1,this.iceServers=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}}class m{async initialize(e){try{let t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.analyser=this.audioContext.createAnalyser(),this.microphone=this.audioContext.createMediaStreamSource(e),this.analyser.fftSize=this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant;let s=this.analyser.frequencyBinCount;return this.dataArray=new Uint8Array(s),this.microphone.connect(this.analyser),this.startDetection(),!0}catch(e){return console.error("Error initializing voice activity detector:",e),!1}}startDetection(){this.isDetecting||(this.isDetecting=!0,this.detectVoice())}stopDetection(){this.isDetecting=!1}detectVoice(){if(!this.isDetecting||!this.analyser||!this.dataArray)return;let e=new Uint8Array(this.dataArray.length);this.analyser.getByteFrequencyData(e);let t=0;for(let s=0;s<e.length;s++)t+=e[s];let s=t/e.length,a=s>this.threshold;this.callbacks.forEach(e=>{try{e(a,s)}catch(e){console.error("Error in voice activity callback:",e)}}),requestAnimationFrame(()=>this.detectVoice())}addCallback(e){this.callbacks.add(e)}removeCallback(e){this.callbacks.delete(e)}setThreshold(e){this.threshold=e}cleanup(){this.stopDetection(),this.microphone&&this.microphone.disconnect(),this.analyser&&this.analyser.disconnect(),this.audioContext&&this.audioContext.close(),this.callbacks.clear()}constructor(){this.audioContext=null,this.analyser=null,this.microphone=null,this.dataArray=null,this.isDetecting=!1,this.threshold=30,this.smoothingTimeConstant=.8,this.fftSize=256,this.callbacks=new Set}}var h=s(6337),u=s(6998),g=s(3569),x=s(8731),b=s(555);function f(e){let{participant:t,stream:s,isSmall:n=!1,showControls:i=!0,isSpeaking:o=!1}=e,l=(0,r.useRef)(null),{user:c,isVideoEnabled:d,isAudioEnabled:m,isScreenSharing:f,isHost:p}=t;return(0,r.useEffect)(()=>{l.current&&s?(l.current.srcObject=s,console.log("VideoTile: Setting video stream for participant:",t.id,s)):console.log("VideoTile: No stream for participant:",t.id,{hasVideoRef:!!l.current,hasStream:!!s,isVideoEnabled:d})},[s,t.id,d]),(0,a.jsxs)("div",{className:"relative ".concat(d&&s?"bg-gray-900":"bg-gray-800 border border-gray-600"," rounded-lg overflow-hidden ").concat(n?"h-16 sm:h-24":"h-full min-h-[120px] sm:min-h-[200px] max-h-[600px]"," transition-all duration-200"),children:[(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:d&&s?(0,a.jsx)("video",{ref:l,autoPlay:!0,playsInline:!0,muted:"local"===t.id,className:"w-full h-full object-contain bg-gray-900 ".concat("local"===t.id?"transform scale-x-[-1]":"")}):(0,a.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-gray-800 to-gray-700 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center p-2 sm:p-4",children:[(0,a.jsx)("div",{className:"bg-gradient-to-br from-gray-600 to-gray-500 rounded-full mx-auto flex items-center justify-center shadow-lg ".concat(n?"p-2 w-8 h-8 sm:p-3 sm:w-12 sm:h-12 mb-1 sm:mb-2":"p-4 sm:p-6 w-16 h-16 sm:w-20 sm:h-20 mb-2 sm:mb-3"),children:(0,a.jsx)(h.A,{className:"text-gray-200 ".concat(n?"h-4 w-4 sm:h-6 sm:w-6":"h-8 w-8 sm:h-10 sm:w-10")})}),!n&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-white text-sm sm:text-base font-medium mb-0.5 sm:mb-1",children:[c.firstName," ",c.lastName]}),(0,a.jsx)("p",{className:"text-gray-300 text-xs",children:"Camera off"})]})]})})}),(0,a.jsxs)("div",{className:"absolute inset-0",children:[f&&(0,a.jsx)("div",{className:"absolute top-1 right-1 sm:top-2 sm:right-2",children:(0,a.jsx)("div",{className:"bg-green-600 text-white px-1.5 py-0.5 sm:px-2 sm:py-1 rounded text-xs font-medium",children:n?"Share":"Sharing"})}),p&&(0,a.jsx)("div",{className:"absolute top-1 left-1 sm:top-2 sm:left-2",children:(0,a.jsx)("div",{className:"bg-blue-600 text-white px-1.5 py-0.5 sm:px-2 sm:py-1 rounded text-xs font-medium",children:"Host"})}),i&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 sm:p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-white text-xs sm:text-sm font-medium truncate mr-2",children:[c.firstName," ",c.lastName,n&&" ("+c.username+")"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"p-1 rounded ".concat(m?"bg-green-600":"bg-red-600"),children:m?(0,a.jsx)(u.A,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-white"}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.A,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-white"}),(0,a.jsx)(g.A,{className:"h-2 w-2 absolute -top-0.5 -right-0.5 text-white"})]})}),(0,a.jsx)("div",{className:"p-1 rounded ".concat(d?"bg-green-600":"bg-red-600"),children:d?(0,a.jsx)(x.A,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-white"}):(0,a.jsx)(b.A,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-white"})})]})]})})]}),m&&o&&(0,a.jsx)("div",{className:"absolute inset-0 border-2 border-green-400 rounded-lg animate-pulse"})]})}function p(e){var t,s;let{participants:r,localStream:n,participantStreams:i,isVideoEnabled:o,isAudioEnabled:l,isScreenSharing:c,currentUser:d,speakingParticipants:m=new Set,screenSharingParticipants:h=new Set}=e,u=[...d?[{id:"local",userId:d._id,user:d,isHost:!1,isVideoEnabled:o,isAudioEnabled:l,isScreenSharing:!1,stream:n}]:[],...r],g=u.find(e=>h.has(e.id));if(g){let e="local"===g.id?n:i.get(g.id);return(0,a.jsxs)("div",{className:"h-full flex flex-col space-y-2 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex-1 bg-gray-900 rounded-lg overflow-hidden relative",children:[e?(0,a.jsx)("video",{autoPlay:!0,playsInline:!0,muted:"local"===g.id,className:"w-full h-full object-contain",ref:t=>{t&&e&&(t.srcObject=e)}}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-white px-4",children:[(0,a.jsx)("div",{className:"bg-green-600 p-3 sm:p-4 rounded-full w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 sm:w-8 sm:h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,a.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-1 sm:mb-2",children:"Screen Share"}),(0,a.jsxs)("p",{className:"text-gray-300 text-sm",children:[g.user.firstName," is sharing their screen"]})]})}),(0,a.jsxs)("div",{className:"absolute top-2 left-2 bg-black/60 text-white px-2 py-1 rounded text-xs",children:[g.user.firstName," is sharing screen"]})]}),(0,a.jsx)("div",{className:"h-16 sm:h-24 flex space-x-2 overflow-x-auto pb-2",children:u.map(e=>(0,a.jsx)("div",{className:"flex-shrink-0 w-24 sm:w-32",children:(0,a.jsx)(f,{participant:e,stream:"local"===e.id?n:i.get(e.id),isSmall:!0,showControls:!1,isSpeaking:m.has(e.id)})},e.id))})]})}return(0,a.jsxs)("div",{className:"h-full max-h-full grid gap-2 sm:gap-4 ".concat(1===(t=u.length)?"grid-cols-1":2===t||t<=4?"grid-cols-1 sm:grid-cols-2":t<=6?"grid-cols-2 sm:grid-cols-3":"grid-cols-2 sm:grid-cols-3 lg:grid-cols-4"," ").concat((s=u.length)<=2?"grid-rows-2 sm:grid-rows-1":s<=4?"grid-rows-4 sm:grid-rows-2":s<=6?"grid-rows-3 sm:grid-rows-2":"grid-rows-4 sm:grid-rows-3"," items-center justify-items-stretch"),children:[u.map(e=>(0,a.jsx)("div",{className:"w-full aspect-video",children:(0,a.jsx)(f,{participant:e,stream:"local"===e.id?n:i.get(e.id),isSmall:!1,showControls:!0,isSpeaking:m.has(e.id)})},e.id)),0===u.length&&(0,a.jsx)("div",{className:"col-span-full flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center text-gray-400 px-4",children:[(0,a.jsx)("svg",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,a.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-1 sm:mb-2",children:"No participants yet"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm sm:text-base",children:"Waiting for participants to join the meeting"})]})})]})}var v=s(6006),y=s(7830);function j(e){let t,s,{message:r,isOwn:n}=e,i=e=>{try{return(0,y.m)(new Date(e),{addSuffix:!0})}catch(e){return"Invalid date"}};return"system"===r.messageType?(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm border border-gray-700",children:r.content})}):(0,a.jsx)("div",{className:"flex ".concat(n?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex max-w-xs lg:max-w-md ".concat(n?"flex-row-reverse":"flex-row"," items-start space-x-2"),children:[!n&&(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-xs font-medium shadow-lg",children:(t=r.sender.firstName,s=r.sender.lastName,"".concat(t.charAt(0)).concat(s.charAt(0)).toUpperCase())})}),(0,a.jsxs)("div",{className:"flex flex-col ".concat(n?"items-end":"items-start"),children:[!n&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-white",children:[r.sender.firstName," ",r.sender.lastName]}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:i(r.createdAt)})]}),(0,a.jsxs)("div",{className:"px-4 py-2 rounded-2xl shadow-sm ".concat(n?"bg-blue-600 text-white rounded-br-md":"bg-gray-800 text-gray-100 border border-gray-700 rounded-bl-md"),children:[r.replyTo&&(0,a.jsxs)("div",{className:"text-xs mb-1 ".concat(n?"text-blue-200":"text-gray-400"),children:["Replying to: ",r.replyTo.content.substring(0,50),r.replyTo.content.length>50?"...":""]}),(0,a.jsx)("div",{className:"text-sm whitespace-pre-wrap break-words",children:r.isDeleted?(0,a.jsx)("em",{className:n?"text-blue-200":"text-gray-400",children:"This message was deleted"}):r.content}),r.isEdited&&!r.isDeleted&&(0,a.jsx)("div",{className:"text-xs mt-1 ".concat(n?"text-blue-200":"text-gray-400"),children:"(edited)"})]}),n&&(0,a.jsx)("span",{className:"text-xs text-gray-400 mt-1",children:i(r.createdAt)}),r.reactions&&r.reactions.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:Object.entries(r.reactionSummary||{}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"bg-gray-700 border border-gray-600 rounded-full px-2 py-1 text-xs flex items-center space-x-1 hover:bg-gray-600 transition-colors",children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)("span",{className:"text-gray-300",children:s.count})]},t)})})]})]})})}var w=s(7062),N=s(6200);function k(e){let{meetingId:t}=e,{user:s}=(0,i.A)(),[n,l]=(0,r.useState)([]),[c,d]=(0,r.useState)(""),[m,h]=(0,r.useState)(!0),[u,g]=(0,r.useState)(!1),[x,b]=(0,r.useState)(new Set),[f,p]=(0,r.useState)(""),[y,k]=(0,r.useState)(!0),[S,C]=(0,r.useState)(1),T=(0,r.useRef)(null),R=(0,r.useRef)(null),A=(0,r.useRef)(null),M=(0,r.useRef)(null),I=(0,r.useRef)(null);(0,r.useEffect)(()=>(W(),E(),()=>{A.current&&v.A.off("new-message",A.current),M.current&&v.A.off("user-typing-start",M.current),I.current&&v.A.off("user-typing-stop",I.current),R.current&&clearTimeout(R.current),console.log("\uD83E\uDDF9 ChatPanel: Cleaned up socket listeners for meeting:",t)}),[t]),(0,r.useEffect)(()=>{D()},[n]);let W=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{s||h(!0);let a=await o.h2.getMessages(t,e,100);if(a.success){let t=a.data.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());s?l(e=>[...t,...e]):l(t),k(100===a.data.length),C(e)}else p("Failed to load messages")}catch(e){console.error("Error loading messages:",e),p("Failed to load messages")}finally{h(!1)}},E=()=>{A.current&&v.A.off("new-message",A.current),M.current&&v.A.off("user-typing-start",M.current),I.current&&v.A.off("user-typing-stop",I.current),A.current=e=>{console.log("\uD83D\uDCEC ChatPanel: Received new message:",e.content),l(t=>{let s=t.findIndex(t=>t._id.startsWith("temp-")&&t.content===e.content&&t.sender._id===e.sender._id);if(-1!==s){console.log("\uD83D\uDCEC ChatPanel: Replacing optimistic message with real message");let a=[...t];return a[s]=e,a}if(t.some(t=>t._id===e._id))return console.log("\uD83D\uDCEC ChatPanel: Duplicate message detected, ignoring"),t;let a=[...t,e];return console.log("\uD83D\uDCEC ChatPanel: Updated messages count:",a.length),a})},M.current=e=>{let{userId:t,user:a}=e;t!==(null==s?void 0:s._id)&&(console.log("⌨️ ChatPanel: User started typing:",a.username),b(e=>new Set([...e,a.username])))},I.current=e=>{let{userId:t}=e;console.log("⌨️ ChatPanel: User stopped typing:",t),b(e=>{let t=new Set(e);return setTimeout(()=>{b(new Set)},1e3),t})},v.A.onNewMessage(A.current),v.A.onUserTypingStart(M.current),v.A.onUserTypingStop(I.current),console.log("\uD83D\uDD0C ChatPanel: Socket listeners set up for meeting:",t)},P=async e=>{if(e.preventDefault(),!c.trim()||u||!s)return;g(!0);let a=c.trim(),r="temp-".concat(Date.now(),"-").concat(Math.random()),n={_id:r,content:a,sender:{_id:s._id,firstName:s.firstName,lastName:s.lastName,username:s.username,email:s.email,isActive:s.isActive,lastLogin:s.lastLogin,createdAt:s.createdAt,updatedAt:s.updatedAt},meeting:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messageType:"text",isDeleted:!1,isEdited:!1,editedAt:null,deletedAt:null,replyTo:null,readBy:[],reactions:[],reactionSummary:{}};l(e=>[...e,n]),d("");try{console.log("\uD83D\uDCE4 ChatPanel: Sending message via socket:",a),v.A.sendMessage(t,a)}catch(e){console.error("❌ ChatPanel: Error sending message:",e),p("Failed to send message"),l(e=>e.filter(e=>e._id!==r)),d(a)}finally{g(!1)}},D=()=>{var e;null==(e=T.current)||e.scrollIntoView({behavior:"smooth"})};return m?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-900",children:(0,a.jsx)(w.A,{size:"medium"})}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full bg-gray-900",children:[f&&(0,a.jsxs)("div",{className:"p-3 bg-red-900/20 border-b border-red-800/30",children:[(0,a.jsx)("p",{className:"text-sm text-red-400",children:f}),(0,a.jsx)("button",{onClick:()=>p(""),className:"text-red-300 hover:text-red-200 text-xs font-medium",children:"Dismiss"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-900",children:[y&&n.length>0&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:()=>W(S+1,!0),className:"text-blue-400 hover:text-blue-300 text-sm font-medium bg-gray-800 px-4 py-2 rounded-lg border border-gray-700 hover:bg-gray-700 transition-colors",disabled:m,children:m?"Loading...":"Load More Messages"})}),0===n.length?(0,a.jsxs)("div",{className:"text-center text-gray-400 py-8",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{className:"text-sm text-gray-300",children:"No messages yet"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Start the conversation!"})]}):n.map(e=>(0,a.jsx)(j,{message:e,isOwn:e.sender._id===(null==s?void 0:s._id)},e._id)),x.size>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-2 bg-gray-800 rounded-lg border border-gray-700",children:[(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,a.jsxs)("span",{className:"text-sm text-gray-300",children:[Array.from(x).join(", ")," ",1===x.size?"is":"are"," typing..."]})]}),(0,a.jsx)("div",{ref:T})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-700 bg-gray-800",children:(0,a.jsxs)("form",{onSubmit:P,className:"flex space-x-3",children:[(0,a.jsx)("input",{type:"text",value:c,onChange:e=>{let s=e.target.value;d(s),s.trim()?(v.A.startTyping(t),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{v.A.stopTyping(t)},1e3)):(v.A.stopTyping(t),R.current&&clearTimeout(R.current))},placeholder:"Type a message...",className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-white placeholder-gray-400 transition-colors",disabled:u}),(0,a.jsx)("button",{type:"submit",disabled:!c.trim()||u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors flex items-center min-w-[44px] justify-center",children:u?(0,a.jsx)(w.A,{size:"small"}):(0,a.jsx)(N.A,{className:"h-4 w-4"})})]})})]})}var S=s(28),C=s(2879),T=s(194),R=s(258),A=s(1915);function M(e){let{isVideoEnabled:t,isAudioEnabled:s,isScreenSharing:r,allowScreenShare:n,onToggleVideo:i,onToggleAudio:o,onToggleScreenShare:l,onLeave:c,isHost:d,onShowParticipants:m,onShowSettings:h,onEndMeeting:f}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"sm:hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 mb-3",children:[(0,a.jsx)("button",{onClick:o,className:"p-3 rounded-full transition-colors ".concat(s?"bg-gray-700 text-white":"bg-red-600 text-white"),title:s?"Mute":"Unmute",children:s?(0,a.jsx)(u.A,{className:"h-5 w-5"}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.A,{className:"h-5 w-5"}),(0,a.jsx)(g.A,{className:"h-3 w-3 absolute -top-1 -right-1 text-red-400"})]})}),(0,a.jsx)("button",{onClick:i,className:"p-3 rounded-full transition-colors ".concat(t?"bg-gray-700 text-white":"bg-red-600 text-white"),title:t?"Turn off camera":"Turn on camera",children:t?(0,a.jsx)(x.A,{className:"h-5 w-5"}):(0,a.jsx)(b.A,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:c,className:"p-3 rounded-full bg-red-600 text-white transition-colors",title:"Leave meeting",children:(0,a.jsx)(S.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[n&&(0,a.jsx)("button",{onClick:l,className:"p-2.5 rounded-full transition-colors ".concat(r?"bg-green-600 text-white":"bg-gray-700 text-white"),title:r?"Stop sharing":"Share screen",children:(0,a.jsx)(C.A,{className:"h-4 w-4"})}),d&&(0,a.jsx)("button",{onClick:m,className:"p-2.5 rounded-full bg-gray-700 text-white transition-colors",title:"Manage participants",children:(0,a.jsx)(T.A,{className:"h-4 w-4"})}),d&&f&&(0,a.jsx)("button",{onClick:f,className:"p-2.5 rounded-full bg-red-600 text-white transition-colors",title:"End meeting for everyone",children:(0,a.jsx)(R.A,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:h,className:"p-2.5 rounded-full bg-gray-700 text-white transition-colors",title:"Settings",children:(0,a.jsx)(A.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:o,className:"p-4 rounded-full transition-colors ".concat(s?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white"),title:s?"Mute":"Unmute",children:s?(0,a.jsx)(u.A,{className:"h-6 w-6"}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.A,{className:"h-6 w-6"}),(0,a.jsx)(g.A,{className:"h-4 w-4 absolute -top-1 -right-1 text-red-400"})]})}),(0,a.jsx)("button",{onClick:i,className:"p-4 rounded-full transition-colors ".concat(t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white"),title:t?"Turn off camera":"Turn on camera",children:t?(0,a.jsx)(x.A,{className:"h-6 w-6"}):(0,a.jsx)(b.A,{className:"h-6 w-6"})}),n&&(0,a.jsx)("button",{onClick:l,className:"p-4 rounded-full transition-colors ".concat(r?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"),title:r?"Stop sharing":"Share screen",children:(0,a.jsx)(C.A,{className:"h-6 w-6"})}),d&&(0,a.jsx)("button",{onClick:m,className:"p-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white transition-colors",title:"Manage participants",children:(0,a.jsx)(T.A,{className:"h-6 w-6"})}),(0,a.jsx)("button",{onClick:h,className:"p-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white transition-colors",title:"Settings",children:(0,a.jsx)(A.A,{className:"h-6 w-6"})}),d&&f&&(0,a.jsx)("button",{onClick:f,className:"p-4 rounded-full bg-red-800 hover:bg-red-900 text-white transition-colors",title:"End meeting for everyone",children:(0,a.jsx)(R.A,{className:"h-6 w-6"})}),(0,a.jsx)("button",{onClick:c,className:"p-4 rounded-full bg-red-600 hover:bg-red-700 text-white transition-colors",title:"Leave meeting",children:(0,a.jsx)(S.A,{className:"h-6 w-6"})})]})]})}var I=s(6834),W=s(9632);function E(e){var t,s,n,o,l,c,d,m,h,u,g,b,f;let{meeting:p,onJoin:v,onCancel:y}=e,[j,N]=(0,r.useState)(""),[k,S]=(0,r.useState)(!1),[C,T]=(0,r.useState)(""),[R,A]=(0,r.useState)((null==(t=p.settings)?void 0:t.requirePassword)||!1),{user:M}=(0,i.A)(),E=!p.isActive,P=(null==M?void 0:M._id)===p.host._id,D=async()=>{S(!0),T("");try{await v(R?j:void 0)}catch(i){var e,t,s,a,r,n;console.error("Join meeting error:",i),(null==(s=i.response)||null==(t=s.data)||null==(e=t.message)?void 0:e.includes("password"))||(null==(a=i.message)?void 0:a.includes("password"))?(A(!0),T("This meeting requires a password")):T((null==(n=i.response)||null==(r=n.data)?void 0:r.message)||i.message||"Failed to join meeting. Please try again.")}finally{S(!1)}};return E&&!P?(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 p-3 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)(I.A,{className:"h-8 w-8 text-yellow-600 dark:text-yellow-400"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Meeting Not Started Yet"}),(0,a.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["The host hasn't started \"",p.title,'" yet']})]}),(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Meeting:"}),(0,a.jsx)("span",{className:"text-gray-900 dark:text-white font-medium",children:p.title})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Host:"}),(0,a.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[p.host.firstName," ",p.host.lastName]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),(0,a.jsx)("span",{className:"text-yellow-600 dark:text-yellow-400 font-medium",children:"Waiting to start"})]})]})}),(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(I.A,{className:"h-5 w-5 text-blue-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Please wait"}),(0,a.jsx)("div",{className:"mt-1 text-sm text-blue-700 dark:text-blue-400",children:(0,a.jsx)("p",{children:"The meeting host will start the meeting soon. You'll be able to join once they start it."})})]})]})}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:y,className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[(0,a.jsx)(W.A,{className:"h-4 w-4 mr-2"}),"Go Back"]}),(0,a.jsxs)("button",{onClick:()=>window.location.reload(),className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Refresh Status"]})]})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)(x.A,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Join Meeting"}),(0,a.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["You're about to join \"",p.title,'"']})]}),(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Meeting ID:"}),(0,a.jsx)("span",{className:"text-gray-900 dark:text-white font-mono",children:p.meetingId})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Host:"}),(0,a.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[p.host.firstName," ",p.host.lastName]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Participants:"}),(0,a.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[p.currentParticipantCount||0," / ",p.maxParticipants]})]})]})}),C&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:C})}),R&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Meeting Password"}),(0,a.jsx)("input",{type:"password",id:"password",value:j,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter meeting password",disabled:k,onKeyDown:e=>{"Enter"!==e.key||k||D()}})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:y,className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",disabled:k,children:[(0,a.jsx)(W.A,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,a.jsx)("button",{onClick:D,className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",disabled:k||R&&!j.trim(),children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.A,{size:"small",className:"mr-2"}),"Joining..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Join Meeting"]})})]}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Meeting Features:"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(s=p.settings)?void 0:s.allowChat)?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(n=p.settings)?void 0:n.allowChat)?"bg-green-500":"bg-gray-400")}),"Chat ",(null==(o=p.settings)?void 0:o.allowChat)?"Enabled":"Disabled"]}),(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(l=p.settings)?void 0:l.allowScreenShare)?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(c=p.settings)?void 0:c.allowScreenShare)?"bg-green-500":"bg-gray-400")}),"Screen Share ",(null==(d=p.settings)?void 0:d.allowScreenShare)?"Enabled":"Disabled"]}),(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(m=p.settings)?void 0:m.waitingRoom)?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(h=p.settings)?void 0:h.waitingRoom)?"bg-yellow-500":"bg-green-500")}),"Waiting Room ",(null==(u=p.settings)?void 0:u.waitingRoom)?"Enabled":"Disabled"]}),(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(g=p.settings)?void 0:g.requirePassword)?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(b=p.settings)?void 0:b.requirePassword)?"bg-yellow-500":"bg-green-500")}),"Password ",(null==(f=p.settings)?void 0:f.requirePassword)?"Required":"Not Required"]})]})]})]})})}var P=s(5821),D=s(4516),V=s(3924);function U(e){var t,s;let{meeting:n,hasJoined:o,onJoin:l,onLeave:c,onError:h}=e,{user:x}=(0,i.A)(),[b,f]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!0),[j,w]=(0,r.useState)(!0),[N,S]=(0,r.useState)(!1),[C,T]=(0,r.useState)(!o),[R,A]=(0,r.useState)([]),[I,W]=(0,r.useState)(null),[U,L]=(0,r.useState)(new Map),[_,z]=(0,r.useState)(new Set),[F,H]=(0,r.useState)(!1),[B,J]=(0,r.useState)(!1),[O,Y]=(0,r.useState)(null),[q,G]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(new Set),X=(0,r.useRef)(null),Z=(0,r.useRef)(null),$=n.host._id===(null==x?void 0:x._id);(0,r.useEffect)(()=>{R.length>0&&console.log("\uD83D\uDD17 MeetingRoom: Connected participants:",R.length,R.map(e=>e.user.firstName))},[R.length]),(0,r.useEffect)(()=>{T(!o)},[o]),(0,r.useEffect)(()=>(o&&!X.current&&ee(),()=>{X.current&&(X.current.leaveMeeting(),X.current.disconnect(),X.current=null),Z.current&&(Z.current.cleanup(),Z.current=null)}),[o,n.meetingId]);let ee=async()=>{if(X.current=new d,await X.current.joinMeeting(n.meetingId,{onParticipantJoined:e=>{console.log("MeetingRoom: Participant joined:",e),A(t=>{console.log("MeetingRoom: Previous participants:",t);let s=[...t,e];return console.log("MeetingRoom: Updated participants:",s),s})},onParticipantLeft:e=>{console.log("MeetingRoom: Participant left:",e),A(t=>{let s=t.filter(t=>t.id!==e);return console.log("MeetingRoom: Participants after leave:",s),s}),L(t=>{let s=new Map(t);return s.delete(e),s})},onParticipantStreamUpdated:(e,t)=>{console.log("\uD83C\uDFA5 MeetingRoom: Received video stream from participant:",e),L(s=>{let a=new Map(s.set(e,t));return console.log("\uD83D\uDCCA MeetingRoom: Total streams now:",a.size),a})},onParticipantScreenShareStarted:(e,t)=>{console.log("\uD83D\uDDA5️ MeetingRoom: Screen share started:",e),Q(t=>{let s=new Set(t);return s.add(e),s}),A(t=>t.map(t=>t.id===e?{...t,isScreenSharing:!0}:t))},onParticipantScreenShareStopped:e=>{console.log("\uD83D\uDDA5️ MeetingRoom: Screen share stopped:",e),Q(t=>{let s=new Set(t);return s.delete(e),s}),A(t=>t.map(t=>t.id===e?{...t,isScreenSharing:!1}:t)),"local"===e&&S(!1)},onParticipantToggleVideo:(e,t)=>{console.log("\uD83C\uDFA5 MeetingRoom: Participant video toggled:",e,t),A(s=>s.map(s=>s.id===e?{...s,isVideoEnabled:t}:s)),x&&(e===x._id||"local"===e)&&(console.log("\uD83C\uDFA5 MeetingRoom: Updating local video state:",t),y(t))},onParticipantToggleAudio:(e,t)=>{console.log("\uD83C\uDFA4 MeetingRoom: Participant audio toggled:",e,t),A(s=>s.map(s=>s.id===e?{...s,isAudioEnabled:t}:s)),x&&(e===x._id||"local"===e)&&(console.log("\uD83C\uDFA4 MeetingRoom: Updating local audio state:",t),w(t),!t&&Z.current?(Z.current.stopDetection(),z(e=>{let t=new Set(e);return t.delete("local"),t})):t&&I&&Z.current&&Z.current.startDetection())},onParticipantVoiceActivity:(e,t)=>{console.log("\uD83D\uDDE3️ MeetingRoom: Participant voice activity:",e,t),z(s=>{let a=new Set(s);return t?a.add(e):a.delete(e),a})},onMeetingEnded:e=>{console.log("\uD83D\uDEAB MeetingRoom: Meeting ended by host:",e),Y("Meeting ended by ".concat(e)),setTimeout(()=>{c()},3e3)},onRemovedFromMeeting:(e,t)=>{console.log("❌ MeetingRoom: Removed from meeting by host:",t),Y("Removed by ".concat(t)),setTimeout(()=>{c()},3e3)},onParticipantRemoved:(e,t)=>{console.log("❌ MeetingRoom: Participant removed:",e,"by:",t),A(t=>t.filter(t=>t.id!==e)),L(t=>{let s=new Map(t);return s.delete(e),s})},onParticipantRemovedSuccess:e=>{console.log("✅ MeetingRoom: Participant removal confirmed:",e)},onHostMutedYou:(e,t)=>{console.log("\uD83D\uDD07 MeetingRoom: Muted by host:",t),G(!0),w(!1),Y("You have been muted by ".concat(t)),setTimeout(()=>Y(null),5e3)},onHostUnmutedYou:(e,t)=>{console.log("\uD83D\uDD0A MeetingRoom: Unmuted by host:",t),G(!1),w(!0),Y("You have been unmuted by ".concat(t)),setTimeout(()=>Y(null),3e3)},onParticipantMutedSuccess:e=>{console.log("✅ MeetingRoom: Participant mute confirmed:",e)},onParticipantUnmutedSuccess:e=>{console.log("✅ MeetingRoom: Participant unmute confirmed:",e)},onError:e=>{console.error("WebRTC error:",e),Y(e),h(e)}})){let e=X.current.getLocalStream();console.log("MeetingRoom: Got local stream:",e),W(e),e&&j&&et(e)}else console.error("MeetingRoom: Failed to join meeting with WebRTC")},et=async e=>{try{Z.current=new m,await Z.current.initialize(e)?(Z.current.addCallback(e=>{z(t=>{let s=new Set(t);return e?s.add("local"):s.delete("local"),s}),X.current&&X.current.broadcastVoiceActivity(e)}),console.log("Voice activity detection initialized successfully")):console.error("Failed to initialize voice activity detection")}catch(e){console.error("Error setting up voice activity detection:",e)}},es=async e=>{try{await l(e),T(!1)}catch(e){}},ea=async()=>{X.current&&y(await X.current.toggleVideo())},er=async()=>{if(X.current){if(q&&!j){Y("You have been muted by the host and cannot unmute yourself"),setTimeout(()=>Y(null),3e3);return}let e=await X.current.toggleAudio();w(e),e&&I?et(I):Z.current&&(Z.current.stopDetection(),z(e=>{let t=new Set(e);return t.delete("local"),t}))}},en=async()=>{if(X.current){let e=await X.current.toggleScreenShare();S(e),Q(t=>{let s=new Set(t);return e?s.add("local"):s.delete("local"),s})}};return C?(0,a.jsx)(E,{meeting:n,onJoin:es,onCancel:()=>window.history.back()}):(0,a.jsxs)("div",{className:"h-screen bg-gray-900 flex flex-col relative",children:[O&&(0,a.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-600 text-white px-4 py-2 rounded-lg shadow-lg animate-fadeIn",children:(0,a.jsx)("p",{className:"text-sm font-medium",children:O})}),(0,a.jsxs)("div",{className:"bg-gray-800 px-3 sm:px-4 py-2 sm:py-3",children:[(0,a.jsxs)("div",{className:"sm:hidden flex flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:(0,a.jsx)("h1",{className:"text-white font-medium text-sm truncate",children:n.title})}),(0,a.jsx)("button",{onClick:c,className:"bg-red-600 text-white px-3 py-1.5 rounded-md text-sm font-medium",children:"Leave"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"}),(0,a.jsxs)("span",{className:"text-xs text-gray-300",children:[R.length+1," participants"]})]}),n.settings.allowChat&&(0,a.jsx)("button",{onClick:()=>f(!b),className:"p-2 rounded-md transition-colors ".concat(b?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"),children:(0,a.jsx)(P.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h1",{className:"text-white font-medium",children:n.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,a.jsxs)("span",{className:"text-sm text-gray-300",children:[R.length+1," participants"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[n.settings.allowChat&&(0,a.jsx)("button",{onClick:()=>f(!b),className:"p-2 rounded-md transition-colors ".concat(b?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:(0,a.jsx)(P.A,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:c,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors",children:"Leave"})]})]})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col sm:flex-row overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col ".concat(b&&"sm:mr-80"),children:[(0,a.jsx)("div",{className:"flex-1 p-2 sm:p-4 min-h-0",children:(0,a.jsx)(p,{participants:R,localStream:I,participantStreams:U,isVideoEnabled:v,isAudioEnabled:j,isScreenSharing:N,currentUser:x,speakingParticipants:_,screenSharingParticipants:K})}),(0,a.jsx)("div",{className:"p-3 sm:p-4 flex-shrink-0 bg-gray-800 sm:bg-transparent",children:(0,a.jsx)(M,{isVideoEnabled:v,isAudioEnabled:j,isScreenSharing:N,allowScreenShare:n.settings.allowScreenShare,onToggleVideo:ea,onToggleAudio:er,onToggleScreenShare:en,onLeave:c,isHost:$,onShowParticipants:()=>{H(!0)},onShowSettings:()=>{J(!0)},onEndMeeting:()=>{X.current&&$&&(console.log("\uD83D\uDEAB MeetingRoom: Host ending meeting"),X.current.endMeeting())}})})]}),b&&n.settings.allowChat&&(0,a.jsxs)("div",{className:"fixed sm:static inset-x-0 bottom-0 top-16 sm:top-0 sm:w-80 bg-gray-900 border-l border-gray-700 flex flex-col z-50 sm:z-auto shadow-2xl",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between bg-gray-800",children:[(0,a.jsxs)("h3",{className:"font-medium text-white flex items-center",children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Chat"]}),(0,a.jsx)("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700 transition-colors",children:(0,a.jsx)(g.A,{className:"h-5 w-5"})})]}),(0,a.jsx)(k,{meetingId:n.meetingId})]})]}),F&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[9999]",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-2xl p-6 w-96 max-h-96 overflow-y-auto border border-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-white",children:["Participants (",R.length+1,")"]}),(0,a.jsx)("button",{onClick:()=>H(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700 transition-colors",children:(0,a.jsx)(g.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[x&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-900/50 rounded-lg border border-blue-700",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium",children:[null==(t=x.firstName)?void 0:t[0],null==(s=x.lastName)?void 0:s[0]]}),(0,a.jsxs)("span",{className:"font-medium text-white",children:[x.firstName," ",x.lastName," (You)"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-blue-300 bg-blue-900/70 px-2 py-1 rounded",children:"Host"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(j?"bg-green-500":"bg-red-500"),title:j?"Audio on":"Audio off"}),(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(v?"bg-green-500":"bg-red-500"),title:v?"Video on":"Video off"})]})]})]}),R.map(e=>{var t,s;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-700 rounded-lg transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium",children:[null==(t=e.user.firstName)?void 0:t[0],null==(s=e.user.lastName)?void 0:s[0]]}),(0,a.jsxs)("span",{className:"text-white",children:[e.user.firstName," ",e.user.lastName]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.isAudioEnabled?"bg-green-500":"bg-red-500"),title:e.isAudioEnabled?"Audio on":"Audio off"}),(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.isVideoEnabled?"bg-green-500":"bg-red-500"),title:e.isVideoEnabled?"Video on":"Video off"})]}),$&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[e.isAudioEnabled?(0,a.jsx)("button",{onClick:()=>{var t;return t=e.id,void(X.current&&$&&(console.log("\uD83D\uDD07 MeetingRoom: Host muting participant:",t),X.current.hostMuteParticipant(t)))},className:"text-yellow-400 hover:text-yellow-300 p-1 rounded-full hover:bg-yellow-900/30 transition-colors",title:"Mute participant",children:(0,a.jsx)(D.A,{className:"h-4 w-4"})}):(0,a.jsx)("button",{onClick:()=>{var t;return t=e.id,void(X.current&&$&&(console.log("\uD83D\uDD0A MeetingRoom: Host unmuting participant:",t),X.current.hostUnmuteParticipant(t)))},className:"text-green-400 hover:text-green-300 p-1 rounded-full hover:bg-green-900/30 transition-colors",title:"Unmute participant",children:(0,a.jsx)(u.A,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>{var t;return t=e.id,void(X.current&&$&&(console.log("❌ MeetingRoom: Host removing participant:",t),X.current.removeParticipant(t)))},className:"text-red-400 hover:text-red-300 p-1 rounded-full hover:bg-red-900/30 transition-colors",title:"Remove participant",children:(0,a.jsx)(V.A,{className:"h-4 w-4"})})]})]})]},e.id)}),0===R.length&&(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"No other participants have joined yet"})})]})]})}),B&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[9999]",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-2xl p-6 w-96 border border-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Settings"}),(0,a.jsx)("button",{onClick:()=>J(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700 transition-colors",children:(0,a.jsx)(g.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white mb-3",children:"Audio & Video Controls"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-200",children:"Camera"}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:v,onChange:ea,className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-200",children:"Microphone"}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:j,onChange:er,className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white mb-3",children:"Meeting Information"}),(0,a.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Meeting ID:"}),(0,a.jsx)("span",{className:"text-sm font-mono text-white",children:n.meetingId})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Title:"}),(0,a.jsx)("span",{className:"text-sm text-white",children:n.title})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Host:"}),(0,a.jsxs)("span",{className:"text-sm text-white",children:[n.host.firstName," ",n.host.lastName]})]})]})]})]})]})})]})}function L(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),{user:s}=(0,i.A)(),[c,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(!0),[u,g]=(0,r.useState)(""),[x,b]=(0,r.useState)(!1),f=e.meetingId;(0,r.useEffect)(()=>{f&&("true"===sessionStorage.getItem("meeting-joined-".concat(f))&&b(!0),p())},[f]);let p=async()=>{try{h(!0),g("");let e=await o.ej.getMeeting(f);if(e.success){d(e.data);let t="true"===sessionStorage.getItem("meeting-joined-".concat(f)),a=e.data.participants.some(e=>e.user._id===(null==s?void 0:s._id)&&!e.leftAt);b(a||t)}else g(e.message)}catch(t){var e;console.error("Error loading meeting:",t),(null==(e=t.response)?void 0:e.status)===404?g("Meeting not found. Please check the meeting ID."):g("Failed to load meeting. Please try again.")}finally{h(!1)}},v=async e=>{try{let t=await o.ej.joinMeeting(f,e?{password:e}:{});t.success?(d(t.data),b(!0),sessionStorage.setItem("meeting-joined-".concat(f),"true")):g(t.message)}catch(e){var t,s;console.error("Error joining meeting:",e),g((null==(s=e.response)||null==(t=s.data)?void 0:t.message)||"Failed to join meeting. Please try again.")}},y=async()=>{try{await o.ej.leaveMeeting(f),sessionStorage.removeItem("meeting-joined-".concat(f)),t.push("/dashboard")}catch(e){console.error("Error leaving meeting:",e),sessionStorage.removeItem("meeting-joined-".concat(f)),t.push("/dashboard")}};return m?(0,a.jsx)(l.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(w.A,{size:"large",className:"text-white"}),(0,a.jsx)("p",{className:"mt-4 text-white",children:"Loading meeting..."})]})})}):u?(0,a.jsx)(l.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center max-w-md",children:[(0,a.jsx)("div",{className:"bg-red-600 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"Unable to load meeting"}),(0,a.jsx)("p",{className:"text-gray-300 mb-6",children:u}),(0,a.jsxs)("div",{className:"space-x-4",children:[(0,a.jsx)("button",{onClick:p,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"}),(0,a.jsx)("button",{onClick:()=>t.push("/dashboard"),className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})]})]})})}):c?(0,a.jsx)(l.A,{children:(0,a.jsx)(U,{meeting:c,hasJoined:x,onJoin:v,onLeave:y,onError:g})}):(0,a.jsx)(l.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-white",children:"Meeting not found"})})})})}},7062:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);function r(e){let{size:t="medium",className:s=""}=e;return(0,a.jsx)("div",{className:"animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ".concat({small:"w-4 h-4",medium:"w-6 h-6",large:"w-8 h-8"}[t]," ").concat(s)})}},9199:(e,t,s)=>{Promise.resolve().then(s.bind(s,6641))}},e=>{e.O(0,[801,288,707,441,493,358],()=>e(e.s=9199)),_N_E=e.O()}]);