(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[213],{4139:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(5155),r=s(2115),i=s(63),n=s(6707),l=s(7062);function o(e){let{children:t}=e,{user:s,isLoading:o,isAuthenticated:c}=(0,n.N)(),d=(0,i.useRouter)();return((0,r.useEffect)(()=>{o||s||d.push("/auth/login")},[s,o,d]),o)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(l.A,{size:"large"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):c?(0,a.jsx)(a.Fragment,{children:t}):null}},6641:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var a=s(5155),r=s(2115),i=s(63),n=s(6707),l=s(7621),o=s(4139),c=s(9829);class d{initializeSocket(){let e="https://meetvault-production.up.railway.app/api".replace("/api",""),t=localStorage.getItem("token");this.socket=(0,c.io)(e,{transports:["websocket","polling"],auth:{token:t}}),this.socket.on("connect",()=>{console.log("\uD83D\uDCE1 WebRTC: Connected to signaling server")}),this.socket.on("disconnect",()=>{console.log("\uD83D\uDCE1 WebRTC: Disconnected from signaling server")}),this.socket.on("user-joined",e=>{var t;console.log("\uD83D\uDC64 WebRTC: User joined:",(null==(t=e.user)?void 0:t.firstName)||e.userId),this.handleUserJoined(e)}),this.socket.on("user-left",e=>{console.log("\uD83D\uDC4B WebRTC: User left:",e.userId),this.handleUserLeft(e.userId)}),this.socket.on("meeting-joined",e=>{var t;console.log("\uD83C\uDF89 WebRTC: Meeting joined! Found",(null==(t=e.participants)?void 0:t.length)||0,"existing participants"),e.participants&&e.participants.length>0?e.participants.forEach(e=>{var t;let s={id:e.userId.toString(),userId:e.userId.toString(),user:e.user,isHost:!1,isVideoEnabled:e.isVideoEnabled,isAudioEnabled:e.isAudioEnabled,isScreenSharing:e.isScreenSharing};console.log("➕ WebRTC: Adding existing participant:",e.user.firstName),null==(t=this.callbacks)||t.onParticipantJoined(s)}):console.log("✨ WebRTC: First participant in meeting")}),this.socket.on("user-disconnected",e=>{console.log("User disconnected:",e),this.handleUserLeft(e.userId)}),this.socket.on("offer",e=>{console.log("\uD83D\uDCDE WebRTC: Received offer from:",e.fromUserId),this.handleOffer(e)}),this.socket.on("answer",e=>{console.log("✅ WebRTC: Received answer from:",e.fromUserId),this.handleAnswer(e)}),this.socket.on("ice-candidate",e=>{console.log("\uD83E\uDDCA WebRTC: Received ICE candidate from:",e.fromUserId),this.handleIceCandidate(e)}),this.socket.on("participant-video-toggled",e=>{var t;null==(t=this.callbacks)||t.onParticipantToggleVideo(e.userId,e.isVideoEnabled)}),this.socket.on("participant-audio-toggled",e=>{var t;null==(t=this.callbacks)||t.onParticipantToggleAudio(e.userId,e.isAudioEnabled)}),this.socket.on("participant-started-screen-share",e=>{console.log("Participant started screen share:",e)}),this.socket.on("participant-stopped-screen-share",e=>{console.log("Participant stopped screen share:",e)}),this.socket.on("error",e=>{var t;console.error("Socket error:",e),null==(t=this.callbacks)||t.onError(e.message||"Connection error")})}async joinMeeting(e,t){var s,a;this.meetingId=e,this.callbacks=t;try{return await this.initializeUserMedia(),null==(s=this.socket)||s.emit("join-meeting",{meetingId:e}),!0}catch(e){return console.error("Failed to join meeting:",e),null==(a=this.callbacks)||a.onError("Failed to access camera/microphone"),!1}}async initializeUserMedia(){try{return this.localStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),this.localStream.getVideoTracks().forEach(e=>{e.enabled=this.mediaControls.video}),this.localStream.getAudioTracks().forEach(e=>{e.enabled=this.mediaControls.audio}),this.localStream}catch(e){throw console.error("Failed to get user media:",e),e}}getLocalStream(){return this.localStream}getLocalScreenStream(){return this.localScreenStream}async toggleVideo(){if(!this.localStream)return!1;let e=this.localStream.getVideoTracks()[0];if(e){var t;return e.enabled=!e.enabled,this.mediaControls.video=e.enabled,null==(t=this.socket)||t.emit("toggle-video",{meetingId:this.meetingId,isVideoEnabled:e.enabled}),e.enabled}return!1}async toggleAudio(){if(!this.localStream)return!1;let e=this.localStream.getAudioTracks()[0];if(e){var t;return e.enabled=!e.enabled,this.mediaControls.audio=e.enabled,null==(t=this.socket)||t.emit("toggle-audio",{meetingId:this.meetingId,isAudioEnabled:e.enabled}),e.enabled}return!1}async toggleScreenShare(){try{var e,t;if(this.mediaControls.screenShare)return this.localScreenStream&&(this.localScreenStream.getTracks().forEach(e=>e.stop()),this.localScreenStream=null),this.mediaControls.screenShare=!1,null==(e=this.socket)||e.emit("stop-screen-share",{meetingId:this.meetingId}),!1;return this.localScreenStream=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),this.mediaControls.screenShare=!0,this.localScreenStream.getVideoTracks()[0].addEventListener("ended",()=>{var e;this.mediaControls.screenShare=!1,this.localScreenStream=null,null==(e=this.socket)||e.emit("stop-screen-share",{meetingId:this.meetingId})}),null==(t=this.socket)||t.emit("start-screen-share",{meetingId:this.meetingId}),!0}catch(e){return console.error("Screen share error:",e),!1}}async handleUserJoined(e){let{userId:t,user:s}=e;console.log("\uD83E\uDD1D WebRTC: Setting up connection with",s.firstName);try{var a,r;if(this.peerConnections.has(t))return void console.log("⚠️ WebRTC: Peer connection already exists for:",s.firstName);let e={id:t,userId:t,user:{_id:t,firstName:s.firstName,lastName:s.lastName,username:s.username,email:s.email||""},isHost:!1,isVideoEnabled:!0,isAudioEnabled:!0,isScreenSharing:!1};console.log("\uD83D\uDD17 WebRTC: Creating peer connection for new participant:",s.firstName);let i=this.createPeerConnection(t);this.peerConnections.set(t,i),this.localStream&&(this.localStream.getTracks().forEach(e=>{i.addTrack(e,this.localStream)}),console.log("\uD83D\uDCF9 WebRTC: Added local stream tracks to peer connection"));let n=await i.createOffer();await i.setLocalDescription(n),console.log("\uD83D\uDCE4 WebRTC: Sending offer to",s.firstName),null==(a=this.socket)||a.emit("offer",{meetingId:this.meetingId,targetUserId:t,offer:n}),null==(r=this.callbacks)||r.onParticipantJoined(e)}catch(e){console.error("❌ WebRTC: Error handling user joined:",s.firstName,e)}}handleUserLeft(e){var t;let s=this.peerConnections.get(e);s&&(s.close(),this.peerConnections.delete(e)),null==(t=this.callbacks)||t.onParticipantLeft(e)}async handleOffer(e){let{fromUserId:t,offer:s}=e;try{var a;if(this.peerConnections.has(t))return void console.log("⚠️ WebRTC: Peer connection already exists for offer from:",t);console.log("\uD83E\uDD1D WebRTC: Creating peer connection to handle offer from:",t);let e=this.createPeerConnection(t);this.peerConnections.set(t,e),this.localStream&&(this.localStream.getTracks().forEach(t=>{e.addTrack(t,this.localStream)}),console.log("\uD83D\uDCF9 WebRTC: Added local stream tracks to peer connection")),await e.setRemoteDescription(s),console.log("\uD83D\uDCE5 WebRTC: Set remote description from offer");let r=await e.createAnswer();await e.setLocalDescription(r),console.log("\uD83D\uDCE4 WebRTC: Sending answer back to:",t),null==(a=this.socket)||a.emit("answer",{meetingId:this.meetingId,targetUserId:t,answer:r})}catch(e){console.error("❌ WebRTC: Error handling offer from:",t,e)}}async handleAnswer(e){let{fromUserId:t,answer:s}=e;try{let e=this.peerConnections.get(t);e?(await e.setRemoteDescription(s),console.log("\uD83D\uDCE5 WebRTC: Set remote description from answer:",t)):console.error("❌ WebRTC: No peer connection found for answer from:",t)}catch(e){console.error("❌ WebRTC: Error handling answer from:",t,e)}}async handleIceCandidate(e){let{fromUserId:t,candidate:s}=e;try{let e=this.peerConnections.get(t);e&&s?(await e.addIceCandidate(s),console.log("\uD83E\uDDCA WebRTC: Added ICE candidate from:",t)):e||console.error("❌ WebRTC: No peer connection found for ICE candidate from:",t)}catch(e){console.error("❌ WebRTC: Error adding ICE candidate from:",t,e)}}createPeerConnection(e){let t=new RTCPeerConnection({iceServers:this.iceServers});return t.onicecandidate=t=>{if(t.candidate){var s;null==(s=this.socket)||s.emit("ice-candidate",{meetingId:this.meetingId,targetUserId:e,candidate:t.candidate})}},t.ontrack=t=>{var s;let[a]=t.streams;console.log("\uD83C\uDFA5 WebRTC: Received video stream from participant:",e),console.log("Stream details:",{id:a.id,videoTracks:a.getVideoTracks().length,audioTracks:a.getAudioTracks().length,active:a.active}),null==(s=this.callbacks)||s.onParticipantStreamUpdated(e,a)},t.onconnectionstatechange=()=>{console.log("\uD83D\uDD17 WebRTC: Connection state changed:",e,"->",t.connectionState),"connected"===t.connectionState?console.log("✅ WebRTC: Successfully connected to participant:",e):"failed"===t.connectionState&&console.error("❌ WebRTC: Connection failed to participant:",e)},t}leaveMeeting(){var e;this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.localScreenStream&&(this.localScreenStream.getTracks().forEach(e=>e.stop()),this.localScreenStream=null),this.peerConnections.forEach(e=>e.close()),this.peerConnections.clear(),null==(e=this.socket)||e.emit("leave-meeting",{meetingId:this.meetingId}),this.meetingId=null,this.callbacks=null}getMediaControls(){return{...this.mediaControls}}disconnect(){var e;this.leaveMeeting(),null==(e=this.socket)||e.disconnect()}constructor(){this.socket=null,this.localStream=null,this.localScreenStream=null,this.peerConnections=new Map,this.meetingId=null,this.callbacks=null,this.mediaControls={video:!0,audio:!0,screenShare:!1},this.iceServers=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],this.initializeSocket()}}class m{async initialize(e){try{let t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.analyser=this.audioContext.createAnalyser(),this.microphone=this.audioContext.createMediaStreamSource(e),this.analyser.fftSize=this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant;let s=this.analyser.frequencyBinCount;return this.dataArray=new Uint8Array(s),this.microphone.connect(this.analyser),this.startDetection(),!0}catch(e){return console.error("Error initializing voice activity detector:",e),!1}}startDetection(){this.isDetecting||(this.isDetecting=!0,this.detectVoice())}stopDetection(){this.isDetecting=!1}detectVoice(){if(!this.isDetecting||!this.analyser||!this.dataArray)return;let e=new Uint8Array(this.dataArray.length);this.analyser.getByteFrequencyData(e);let t=0;for(let s=0;s<e.length;s++)t+=e[s];let s=t/e.length,a=s>this.threshold;this.callbacks.forEach(e=>{try{e(a,s)}catch(e){console.error("Error in voice activity callback:",e)}}),requestAnimationFrame(()=>this.detectVoice())}addCallback(e){this.callbacks.add(e)}removeCallback(e){this.callbacks.delete(e)}setThreshold(e){this.threshold=e}cleanup(){this.stopDetection(),this.microphone&&this.microphone.disconnect(),this.analyser&&this.analyser.disconnect(),this.audioContext&&this.audioContext.close(),this.callbacks.clear()}constructor(){this.audioContext=null,this.analyser=null,this.microphone=null,this.dataArray=null,this.isDetecting=!1,this.threshold=30,this.smoothingTimeConstant=.8,this.fftSize=256,this.callbacks=new Set}}var h=s(6337),x=s(6998),g=s(3569),u=s(8731),f=s(555);function b(e){let{participant:t,stream:s,isSmall:i=!1,showControls:n=!0,isSpeaking:l=!1}=e,o=(0,r.useRef)(null),{user:c,isVideoEnabled:d,isAudioEnabled:m,isScreenSharing:b,isHost:p}=t;return(0,r.useEffect)(()=>{o.current&&s?(o.current.srcObject=s,console.log("VideoTile: Setting video stream for participant:",t.id,s)):console.log("VideoTile: No stream for participant:",t.id,{hasVideoRef:!!o.current,hasStream:!!s,isVideoEnabled:d})},[s,t.id,d]),(0,a.jsxs)("div",{className:"relative ".concat(d&&s?"bg-gray-900":"bg-gray-800 border border-gray-600"," rounded-lg overflow-hidden ").concat(i?"h-24":"h-full min-h-[200px] max-h-[600px]"," transition-all duration-200"),children:[(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:d&&s?(0,a.jsx)("video",{ref:o,autoPlay:!0,playsInline:!0,muted:"local"===t.id,className:"w-full h-full object-contain bg-gray-900 ".concat("local"===t.id?"transform scale-x-[-1]":"")}):(0,a.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-gray-800 to-gray-700 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center p-4",children:[(0,a.jsx)("div",{className:"bg-gradient-to-br from-gray-600 to-gray-500 p-6 rounded-full w-20 h-20 mx-auto mb-3 flex items-center justify-center shadow-lg",children:(0,a.jsx)(h.A,{className:"h-10 w-10 text-gray-200"})}),!i&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-white text-base font-medium mb-1",children:[c.firstName," ",c.lastName]}),(0,a.jsx)("p",{className:"text-gray-300 text-xs",children:"Camera off"})]})]})})}),(0,a.jsxs)("div",{className:"absolute inset-0",children:[b&&(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsx)("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-medium",children:"Sharing"})}),p&&(0,a.jsx)("div",{className:"absolute top-2 left-2",children:(0,a.jsx)("div",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:"Host"})}),n&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-white text-sm font-medium truncate",children:[c.firstName," ",c.lastName,i&&" ("+c.username+")"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"p-1 rounded ".concat(m?"bg-green-600":"bg-red-600"),children:m?(0,a.jsx)(x.A,{className:"h-3 w-3 text-white"}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"h-3 w-3 text-white"}),(0,a.jsx)(g.A,{className:"h-2 w-2 absolute -top-0.5 -right-0.5 text-white"})]})}),(0,a.jsx)("div",{className:"p-1 rounded ".concat(d?"bg-green-600":"bg-red-600"),children:d?(0,a.jsx)(u.A,{className:"h-3 w-3 text-white"}):(0,a.jsx)(f.A,{className:"h-3 w-3 text-white"})})]})]})})]}),m&&l&&(0,a.jsx)("div",{className:"absolute inset-0 border-2 border-green-400 rounded-lg animate-pulse"})]})}function p(e){var t,s;let{participants:r,localStream:i,participantStreams:n,isVideoEnabled:l,isScreenSharing:o,currentUser:c,speakingParticipants:d=new Set}=e,m=[...c?[{id:"local",userId:c._id,user:c,isHost:!1,isVideoEnabled:l,isAudioEnabled:!0,isScreenSharing:!1,stream:i}]:[],...r];return o?(0,a.jsxs)("div",{className:"h-full flex flex-col space-y-4",children:[(0,a.jsx)("div",{className:"flex-1 bg-gray-800 rounded-lg flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)("div",{className:"bg-green-600 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Screen Share"}),(0,a.jsx)("p",{className:"text-gray-300",children:"Screen sharing content will appear here"})]})}),(0,a.jsx)("div",{className:"h-24 flex space-x-2 overflow-x-auto",children:m.map(e=>(0,a.jsx)("div",{className:"flex-shrink-0 w-32",children:(0,a.jsx)(b,{participant:e,stream:"local"===e.id?i:n.get(e.id),isSmall:!0,showControls:!1,isSpeaking:d.has(e.id)})},e.id))})]}):(0,a.jsxs)("div",{className:"h-full max-h-full grid gap-4 p-2 ".concat(1===(t=m.length)?"grid-cols-1":2===t||t<=4?"grid-cols-2":t<=6?"grid-cols-3":"grid-cols-4"," ").concat((s=m.length)<=2?"grid-rows-1":s<=4||s<=6?"grid-rows-2":"grid-rows-3"," items-center justify-items-stretch"),children:[m.map(e=>(0,a.jsx)("div",{className:"w-full aspect-video",children:(0,a.jsx)(b,{participant:e,stream:"local"===e.id?i:n.get(e.id),isSmall:!1,showControls:!0,isSpeaking:d.has(e.id)})},e.id)),0===m.length&&(0,a.jsx)("div",{className:"col-span-full flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-gray-400",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No participants yet"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Waiting for participants to join the meeting"})]})})]})}var j=s(6006),y=s(7830);function v(e){let t,s,{message:r,isOwn:i}=e,n=e=>{try{return(0,y.m)(new Date(e),{addSuffix:!0})}catch(e){return"Invalid date"}};return"system"===r.messageType?(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm",children:r.content})}):(0,a.jsx)("div",{className:"flex ".concat(i?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex max-w-xs lg:max-w-md ".concat(i?"flex-row-reverse":"flex-row"," items-start space-x-2"),children:[!i&&(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium",children:(t=r.sender.firstName,s=r.sender.lastName,"".concat(t.charAt(0)).concat(s.charAt(0)).toUpperCase())})}),(0,a.jsxs)("div",{className:"flex flex-col ".concat(i?"items-end":"items-start"),children:[!i&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[r.sender.firstName," ",r.sender.lastName]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:n(r.createdAt)})]}),(0,a.jsxs)("div",{className:"px-3 py-2 rounded-lg ".concat(i?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[r.replyTo&&(0,a.jsxs)("div",{className:"text-xs mb-1 ".concat(i?"text-blue-100":"text-gray-500"),children:["Replying to: ",r.replyTo.content.substring(0,50),r.replyTo.content.length>50?"...":""]}),(0,a.jsx)("div",{className:"text-sm whitespace-pre-wrap break-words",children:r.isDeleted?(0,a.jsx)("em",{className:i?"text-blue-200":"text-gray-500",children:"This message was deleted"}):r.content}),r.isEdited&&!r.isDeleted&&(0,a.jsx)("div",{className:"text-xs mt-1 ".concat(i?"text-blue-200":"text-gray-500"),children:"(edited)"})]}),i&&(0,a.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:n(r.createdAt)}),r.reactions&&r.reactions.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:Object.entries(r.reactionSummary||{}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"bg-gray-200 rounded-full px-2 py-1 text-xs flex items-center space-x-1",children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)("span",{className:"text-gray-600",children:s.count})]},t)})})]})]})})}var N=s(7062),w=s(6200);function k(e){let{meetingId:t}=e,{user:s}=(0,n.A)(),[i,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(""),[m,h]=(0,r.useState)(!0),[x,g]=(0,r.useState)(!1),[u,f]=(0,r.useState)(new Set),[b,p]=(0,r.useState)(""),y=(0,r.useRef)(null),k=(0,r.useRef)(null);(0,r.useEffect)(()=>(S(),C(),()=>{j.A.off("new-message"),j.A.off("user-typing-start"),j.A.off("user-typing-stop"),k.current&&clearTimeout(k.current)}),[t]),(0,r.useEffect)(()=>{T()},[i]);let S=async()=>{try{h(!0);let e=await l.h2.getMessages(t,1,50);e.success?o(e.data.reverse()):p("Failed to load messages")}catch(e){console.error("Error loading messages:",e),p("Failed to load messages")}finally{h(!1)}},C=()=>{j.A.onNewMessage(e=>{o(t=>[...t,e])}),j.A.onUserTypingStart(e=>{let{userId:t,user:a}=e;t!==(null==s?void 0:s._id)&&f(e=>new Set([...e,a.username]))}),j.A.onUserTypingStop(e=>{let{userId:t}=e;f(e=>new Set(e))})},A=async e=>{if(e.preventDefault(),!c.trim()||x)return;g(!0);let s=c.trim();d("");try{j.A.sendMessage(t,s)}catch(e){console.error("Error sending message:",e),p("Failed to send message"),d(s)}finally{g(!1)}},T=()=>{var e;null==(e=y.current)||e.scrollIntoView({behavior:"smooth"})};return m?(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)(N.A,{size:"medium"})}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[b&&(0,a.jsxs)("div",{className:"p-3 bg-red-50 border-b border-red-200",children:[(0,a.jsx)("p",{className:"text-sm text-red-600",children:b}),(0,a.jsx)("button",{onClick:()=>p(""),className:"text-red-700 hover:text-red-800 text-xs font-medium",children:"Dismiss"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===i.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{className:"text-sm",children:"No messages yet"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Start the conversation!"})]}):i.map(e=>(0,a.jsx)(v,{message:e,isOwn:e.sender._id===(null==s?void 0:s._id)},e._id)),u.size>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-2 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[Array.from(u).join(", ")," ",1===u.size?"is":"are"," typing..."]})]}),(0,a.jsx)("div",{ref:y})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,a.jsxs)("form",{onSubmit:A,className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:c,onChange:e=>{let s=e.target.value;d(s),s.trim()?(j.A.startTyping(t),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{j.A.stopTyping(t)},1e3)):(j.A.stopTyping(t),k.current&&clearTimeout(k.current))},placeholder:"Type a message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:x}),(0,a.jsx)("button",{type:"submit",disabled:!c.trim()||x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center",children:x?(0,a.jsx)(N.A,{size:"small"}):(0,a.jsx)(w.A,{className:"h-4 w-4"})})]})})]})}var S=s(2879),C=s(194),A=s(1915),T=s(28);function E(e){let{isVideoEnabled:t,isAudioEnabled:s,isScreenSharing:r,allowScreenShare:i,onToggleVideo:n,onToggleAudio:l,onToggleScreenShare:o,onLeave:c,isHost:d,onShowParticipants:m,onShowSettings:h}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:l,className:"p-4 rounded-full transition-colors ".concat(s?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white"),title:s?"Mute":"Unmute",children:s?(0,a.jsx)(x.A,{className:"h-6 w-6"}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"h-6 w-6"}),(0,a.jsx)(g.A,{className:"h-4 w-4 absolute -top-1 -right-1 text-red-400"})]})}),(0,a.jsx)("button",{onClick:n,className:"p-4 rounded-full transition-colors ".concat(t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-red-600 hover:bg-red-700 text-white"),title:t?"Turn off camera":"Turn on camera",children:t?(0,a.jsx)(u.A,{className:"h-6 w-6"}):(0,a.jsx)(f.A,{className:"h-6 w-6"})}),i&&(0,a.jsx)("button",{onClick:o,className:"p-4 rounded-full transition-colors ".concat(r?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"),title:r?"Stop sharing":"Share screen",children:(0,a.jsx)(S.A,{className:"h-6 w-6"})}),d&&(0,a.jsx)("button",{onClick:m,className:"p-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white transition-colors",title:"Manage participants",children:(0,a.jsx)(C.A,{className:"h-6 w-6"})}),(0,a.jsx)("button",{onClick:h,className:"p-4 rounded-full bg-gray-700 hover:bg-gray-600 text-white transition-colors",title:"Settings",children:(0,a.jsx)(A.A,{className:"h-6 w-6"})}),(0,a.jsx)("button",{onClick:c,className:"p-4 rounded-full bg-red-600 hover:bg-red-700 text-white transition-colors",title:"Leave meeting",children:(0,a.jsx)(T.A,{className:"h-6 w-6"})})]})}var R=s(6834),I=s(9632);function M(e){var t,s,i,l,o,c,d,m,h,x,g,f,b;let{meeting:p,onJoin:j,onCancel:y}=e,[v,w]=(0,r.useState)(""),[k,S]=(0,r.useState)(!1),[C,A]=(0,r.useState)(""),[T,E]=(0,r.useState)((null==(t=p.settings)?void 0:t.requirePassword)||!1),{user:M}=(0,n.A)(),P=!p.isActive,W=(null==M?void 0:M._id)===p.host._id,D=async()=>{S(!0),A("");try{await j(T?v:void 0)}catch(n){var e,t,s,a,r,i;console.error("Join meeting error:",n),(null==(s=n.response)||null==(t=s.data)||null==(e=t.message)?void 0:e.includes("password"))||(null==(a=n.message)?void 0:a.includes("password"))?(E(!0),A("This meeting requires a password")):A((null==(i=n.response)||null==(r=i.data)?void 0:r.message)||n.message||"Failed to join meeting. Please try again.")}finally{S(!1)}};return P&&!W?(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 p-3 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)(R.A,{className:"h-8 w-8 text-yellow-600 dark:text-yellow-400"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Meeting Not Started Yet"}),(0,a.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["The host hasn't started \"",p.title,'" yet']})]}),(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Meeting:"}),(0,a.jsx)("span",{className:"text-gray-900 dark:text-white font-medium",children:p.title})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Host:"}),(0,a.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[p.host.firstName," ",p.host.lastName]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),(0,a.jsx)("span",{className:"text-yellow-600 dark:text-yellow-400 font-medium",children:"Waiting to start"})]})]})}),(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(R.A,{className:"h-5 w-5 text-blue-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Please wait"}),(0,a.jsx)("div",{className:"mt-1 text-sm text-blue-700 dark:text-blue-400",children:(0,a.jsx)("p",{children:"The meeting host will start the meeting soon. You'll be able to join once they start it."})})]})]})}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:y,className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Go Back"]}),(0,a.jsxs)("button",{onClick:()=>window.location.reload(),className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Refresh Status"]})]})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)(u.A,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Join Meeting"}),(0,a.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["You're about to join \"",p.title,'"']})]}),(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Meeting ID:"}),(0,a.jsx)("span",{className:"text-gray-900 dark:text-white font-mono",children:p.meetingId})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Host:"}),(0,a.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[p.host.firstName," ",p.host.lastName]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Participants:"}),(0,a.jsxs)("span",{className:"text-gray-900 dark:text-white",children:[p.currentParticipantCount||0," / ",p.maxParticipants]})]})]})}),C&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:C})}),T&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Meeting Password"}),(0,a.jsx)("input",{type:"password",id:"password",value:v,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter meeting password",disabled:k,onKeyDown:e=>{"Enter"!==e.key||k||D()}})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:y,className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",disabled:k,children:[(0,a.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,a.jsx)("button",{onClick:D,className:"flex-1 flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",disabled:k||T&&!v.trim(),children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.A,{size:"small",className:"mr-2"}),"Joining..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Join Meeting"]})})]}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Meeting Features:"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(s=p.settings)?void 0:s.allowChat)?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(i=p.settings)?void 0:i.allowChat)?"bg-green-500":"bg-gray-400")}),"Chat ",(null==(l=p.settings)?void 0:l.allowChat)?"Enabled":"Disabled"]}),(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(o=p.settings)?void 0:o.allowScreenShare)?"text-green-600 dark:text-green-400":"text-gray-400 dark:text-gray-500"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(c=p.settings)?void 0:c.allowScreenShare)?"bg-green-500":"bg-gray-400")}),"Screen Share ",(null==(d=p.settings)?void 0:d.allowScreenShare)?"Enabled":"Disabled"]}),(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(m=p.settings)?void 0:m.waitingRoom)?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(h=p.settings)?void 0:h.waitingRoom)?"bg-yellow-500":"bg-green-500")}),"Waiting Room ",(null==(x=p.settings)?void 0:x.waitingRoom)?"Enabled":"Disabled"]}),(0,a.jsxs)("div",{className:"flex items-center ".concat((null==(g=p.settings)?void 0:g.requirePassword)?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((null==(f=p.settings)?void 0:f.requirePassword)?"bg-yellow-500":"bg-green-500")}),"Password ",(null==(b=p.settings)?void 0:b.requirePassword)?"Required":"Not Required"]})]})]})]})})}var P=s(5821);function W(e){var t,s;let{meeting:i,hasJoined:l,onJoin:o,onLeave:c,onError:h}=e,{user:x}=(0,n.A)(),[u,f]=(0,r.useState)(!1),[b,j]=(0,r.useState)(!0),[y,v]=(0,r.useState)(!0),[N,w]=(0,r.useState)(!1),[S,C]=(0,r.useState)(!l),[A,T]=(0,r.useState)([]),[R,I]=(0,r.useState)(null),[W,D]=(0,r.useState)(new Map),[V,L]=(0,r.useState)(new Set),[U,z]=(0,r.useState)(!1),[F,_]=(0,r.useState)(!1),[J,H]=(0,r.useState)(null),q=(0,r.useRef)(null),B=(0,r.useRef)(null),O=i.host._id===(null==x?void 0:x._id);(0,r.useEffect)(()=>{A.length>0&&console.log("\uD83D\uDD17 MeetingRoom: Connected participants:",A.length,A.map(e=>e.user.firstName))},[A.length]),(0,r.useEffect)(()=>{C(!l)},[l]),(0,r.useEffect)(()=>(l&&!q.current&&Y(),()=>{q.current&&(q.current.leaveMeeting(),q.current.disconnect(),q.current=null),B.current&&(B.current.cleanup(),B.current=null)}),[l,i.meetingId]);let Y=async()=>{if(q.current=new d,await q.current.joinMeeting(i.meetingId,{onParticipantJoined:e=>{console.log("MeetingRoom: Participant joined:",e),T(t=>{console.log("MeetingRoom: Previous participants:",t);let s=[...t,e];return console.log("MeetingRoom: Updated participants:",s),s})},onParticipantLeft:e=>{console.log("MeetingRoom: Participant left:",e),T(t=>{let s=t.filter(t=>t.id!==e);return console.log("MeetingRoom: Participants after leave:",s),s}),D(t=>{let s=new Map(t);return s.delete(e),s})},onParticipantStreamUpdated:(e,t)=>{console.log("\uD83C\uDFA5 MeetingRoom: Received video stream from participant:",e),D(s=>{let a=new Map(s.set(e,t));return console.log("\uD83D\uDCCA MeetingRoom: Total streams now:",a.size),a})},onParticipantScreenShareStarted:(e,t)=>{console.log("Screen share started:",e)},onParticipantScreenShareStopped:e=>{console.log("Screen share stopped:",e)},onParticipantToggleVideo:(e,t)=>{T(s=>s.map(s=>s.id===e?{...s,isVideoEnabled:t}:s))},onParticipantToggleAudio:(e,t)=>{T(s=>s.map(s=>s.id===e?{...s,isAudioEnabled:t}:s))},onError:e=>{console.error("WebRTC error:",e),H(e),h(e)}})){let e=q.current.getLocalStream();console.log("MeetingRoom: Got local stream:",e),I(e),e&&y&&G(e)}else console.error("MeetingRoom: Failed to join meeting with WebRTC")},G=async e=>{try{B.current=new m,await B.current.initialize(e)?(B.current.addCallback(e=>{L(t=>{let s=new Set(t);return e?s.add("local"):s.delete("local"),s})}),console.log("Voice activity detection initialized successfully")):console.error("Failed to initialize voice activity detection")}catch(e){console.error("Error setting up voice activity detection:",e)}},K=async e=>{try{await o(e),C(!1)}catch(e){}},Q=async()=>{q.current&&j(await q.current.toggleVideo())},X=async()=>{if(q.current){let e=await q.current.toggleAudio();v(e),e&&R?G(R):B.current&&(B.current.stopDetection(),L(e=>{let t=new Set(e);return t.delete("local"),t}))}},Z=async()=>{q.current&&w(await q.current.toggleScreenShare())};return S?(0,a.jsx)(M,{meeting:i,onJoin:K,onCancel:()=>window.history.back()}):(0,a.jsxs)("div",{className:"h-screen bg-gray-900 flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-gray-800 px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h1",{className:"text-white font-medium",children:i.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,a.jsxs)("span",{className:"text-sm text-gray-300",children:[A.length+1," participants"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[i.settings.allowChat&&(0,a.jsx)("button",{onClick:()=>f(!u),className:"p-2 rounded-md transition-colors ".concat(u?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:(0,a.jsx)(P.A,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:c,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors",children:"Leave"})]})]}),(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col ".concat(u?"mr-80":""),children:[(0,a.jsx)("div",{className:"flex-1 p-4 min-h-0",children:(0,a.jsx)(p,{participants:A,localStream:R,participantStreams:W,isVideoEnabled:b,isScreenSharing:N,currentUser:x,speakingParticipants:V})}),(0,a.jsx)("div",{className:"p-4 flex-shrink-0",children:(0,a.jsx)(E,{isVideoEnabled:b,isAudioEnabled:y,isScreenSharing:N,allowScreenShare:i.settings.allowScreenShare,onToggleVideo:Q,onToggleAudio:X,onToggleScreenShare:Z,onLeave:c,isHost:O,onShowParticipants:()=>{z(!0)},onShowSettings:()=>{_(!0)}})})]}),u&&i.settings.allowChat&&(0,a.jsxs)("div",{className:"w-80 bg-white border-l border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Chat"}),(0,a.jsx)("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(g.A,{className:"h-5 w-5"})})]}),(0,a.jsx)(k,{meetingId:i.meetingId})]})]}),U&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[9999]",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-2xl p-6 w-96 max-h-96 overflow-y-auto border border-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-white",children:["Participants (",A.length+1,")"]}),(0,a.jsx)("button",{onClick:()=>z(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700 transition-colors",children:(0,a.jsx)(g.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[x&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-900/50 rounded-lg border border-blue-700",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium",children:[null==(t=x.firstName)?void 0:t[0],null==(s=x.lastName)?void 0:s[0]]}),(0,a.jsxs)("span",{className:"font-medium text-white",children:[x.firstName," ",x.lastName," (You)"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-blue-300 bg-blue-900/70 px-2 py-1 rounded",children:"Host"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(y?"bg-green-500":"bg-red-500"),title:y?"Audio on":"Audio off"}),(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(b?"bg-green-500":"bg-red-500"),title:b?"Video on":"Video off"})]})]})]}),A.map(e=>{var t,s;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-700 rounded-lg transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium",children:[null==(t=e.user.firstName)?void 0:t[0],null==(s=e.user.lastName)?void 0:s[0]]}),(0,a.jsxs)("span",{className:"text-white",children:[e.user.firstName," ",e.user.lastName]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.isAudioEnabled?"bg-green-500":"bg-red-500"),title:e.isAudioEnabled?"Audio on":"Audio off"}),(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.isVideoEnabled?"bg-green-500":"bg-red-500"),title:e.isVideoEnabled?"Video on":"Video off"})]})})]},e.id)}),0===A.length&&(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"No other participants have joined yet"})})]})]})}),F&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[9999]",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-2xl p-6 w-96 border border-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Settings"}),(0,a.jsx)("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700 transition-colors",children:(0,a.jsx)(g.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white mb-3",children:"Audio & Video Controls"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-200",children:"Camera"}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:b,onChange:Q,className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-200",children:"Microphone"}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:y,onChange:X,className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white mb-3",children:"Meeting Information"}),(0,a.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Meeting ID:"}),(0,a.jsx)("span",{className:"text-sm font-mono text-white",children:i.meetingId})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Title:"}),(0,a.jsx)("span",{className:"text-sm text-white",children:i.title})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Host:"}),(0,a.jsxs)("span",{className:"text-sm text-white",children:[i.host.firstName," ",i.host.lastName]})]})]})]})]})]})})]})}function D(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),{user:s}=(0,n.A)(),[c,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(!0),[x,g]=(0,r.useState)(""),[u,f]=(0,r.useState)(!1),b=e.meetingId;(0,r.useEffect)(()=>{b&&p()},[b]);let p=async()=>{try{h(!0),g("");let e=await l.ej.getMeeting(b);if(e.success){d(e.data);let t=e.data.participants.some(e=>e.user._id===(null==s?void 0:s._id)&&!e.leftAt);f(t)}else g(e.message)}catch(t){var e;console.error("Error loading meeting:",t),(null==(e=t.response)?void 0:e.status)===404?g("Meeting not found. Please check the meeting ID."):g("Failed to load meeting. Please try again.")}finally{h(!1)}},j=async e=>{try{let t=await l.ej.joinMeeting(b,e?{password:e}:{});t.success?(d(t.data),f(!0)):g(t.message)}catch(e){var t,s;console.error("Error joining meeting:",e),g((null==(s=e.response)||null==(t=s.data)?void 0:t.message)||"Failed to join meeting. Please try again.")}},y=async()=>{try{await l.ej.leaveMeeting(b),t.push("/dashboard")}catch(e){console.error("Error leaving meeting:",e),t.push("/dashboard")}};return m?(0,a.jsx)(o.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(N.A,{size:"large",className:"text-white"}),(0,a.jsx)("p",{className:"mt-4 text-white",children:"Loading meeting..."})]})})}):x?(0,a.jsx)(o.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center max-w-md",children:[(0,a.jsx)("div",{className:"bg-red-600 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"Unable to load meeting"}),(0,a.jsx)("p",{className:"text-gray-300 mb-6",children:x}),(0,a.jsxs)("div",{className:"space-x-4",children:[(0,a.jsx)("button",{onClick:p,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"}),(0,a.jsx)("button",{onClick:()=>t.push("/dashboard"),className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})]})]})})}):c?(0,a.jsx)(o.A,{children:(0,a.jsx)(W,{meeting:c,hasJoined:u,onJoin:j,onLeave:y,onError:g})}):(0,a.jsx)(o.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-white",children:"Meeting not found"})})})})}},7062:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);function r(e){let{size:t="medium",className:s=""}=e;return(0,a.jsx)("div",{className:"animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ".concat({small:"w-4 h-4",medium:"w-6 h-6",large:"w-8 h-8"}[t]," ").concat(s)})}},9199:(e,t,s)=>{Promise.resolve().then(s.bind(s,6641))}},e=>{e.O(0,[801,735,707,441,493,358],()=>e(e.s=9199)),_N_E=e.O()}]);