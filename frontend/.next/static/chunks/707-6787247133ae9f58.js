"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[707],{6006:(e,t,s)=>{s.d(t,{A:()=>n});var o=s(9829);class a{connect(e){return new Promise((t,s)=>{this.socket&&this.disconnect();let a="https://meetvault-production.up.railway.app/api".replace("/api","")||"http://localhost:3000";this.socket=(0,o.io)(a,{auth:{token:e},transports:["websocket","polling"]}),this.socket.on("connect",()=>{var e;console.log("Socket connected:",null==(e=this.socket)?void 0:e.id),this.isConnected=!0,t()}),this.socket.on("connect_error",e=>{console.error("Socket connection error:",e),this.isConnected=!1,s(e)}),this.socket.on("disconnect",e=>{console.log("Socket disconnected:",e),this.isConnected=!1}),this.socket.on("error",e=>{console.error("Socket error:",e)})})}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1)}getConnectionStatus(){return this.isConnected}joinMeeting(e){this.socket&&this.socket.emit("join-meeting",{meetingId:e})}leaveMeeting(e){this.socket&&this.socket.emit("leave-meeting",{meetingId:e})}sendOffer(e,t){this.socket&&this.socket.emit("offer",{targetUserId:e,offer:t})}sendAnswer(e,t){this.socket&&this.socket.emit("answer",{targetUserId:e,answer:t})}sendIceCandidate(e,t){this.socket&&this.socket.emit("ice-candidate",{targetUserId:e,candidate:t})}toggleVideo(e,t){this.socket&&this.socket.emit("toggle-video",{meetingId:e,isVideoEnabled:t})}toggleAudio(e,t){this.socket&&this.socket.emit("toggle-audio",{meetingId:e,isAudioEnabled:t})}startScreenShare(e){this.socket&&this.socket.emit("start-screen-share",{meetingId:e})}stopScreenShare(e){this.socket&&this.socket.emit("stop-screen-share",{meetingId:e})}sendMessage(e,t,s){this.socket&&this.socket.emit("send-message",{meetingId:e,content:t,replyTo:s})}startTyping(e){this.socket&&this.socket.emit("typing-start",{meetingId:e})}stopTyping(e){this.socket&&this.socket.emit("typing-stop",{meetingId:e})}onMeetingJoined(e){this.socket&&this.socket.on("meeting-joined",e)}onUserJoined(e){this.socket&&this.socket.on("user-joined",e)}onUserLeft(e){this.socket&&this.socket.on("user-left",e)}onUserDisconnected(e){this.socket&&this.socket.on("user-disconnected",e)}onOffer(e){this.socket&&this.socket.on("offer",e)}onAnswer(e){this.socket&&this.socket.on("answer",e)}onIceCandidate(e){this.socket&&this.socket.on("ice-candidate",e)}onParticipantVideoToggled(e){this.socket&&this.socket.on("participant-video-toggled",e)}onParticipantAudioToggled(e){this.socket&&this.socket.on("participant-audio-toggled",e)}onParticipantStartedScreenShare(e){this.socket&&this.socket.on("participant-started-screen-share",e)}onParticipantStoppedScreenShare(e){this.socket&&this.socket.on("participant-stopped-screen-share",e)}onNewMessage(e){this.socket&&this.socket.on("new-message",e)}onUserTypingStart(e){this.socket&&this.socket.on("user-typing-start",e)}onUserTypingStop(e){this.socket&&this.socket.on("user-typing-stop",e)}onSocketError(e){this.socket&&this.socket.on("error",e)}removeAllListeners(){this.socket&&this.socket.removeAllListeners()}off(e,t){this.socket&&this.socket.off(e,t)}constructor(){this.socket=null,this.isConnected=!1}}let n=new a},6707:(e,t,s)=>{s.d(t,{A:()=>l,AuthProvider:()=>h,N:()=>d});var o=s(5155),a=s(2115),n=s(7621),c=s(6006),i=s(6489);let r=(0,a.createContext)(void 0);function h(e){let{children:t}=e,[s,h]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),{data:g,status:u}=(0,i.useSession)();(0,a.useEffect)(()=>{k()},[g,u]);let k=async()=>{try{if(null==g?void 0:g.backendToken){localStorage.setItem("authToken",g.backendToken),g.refreshToken&&localStorage.setItem("refreshToken",g.refreshToken);let e=await n.R2.getProfile();if(e.success){h(e.data);try{await c.A.connect(g.backendToken)}catch(e){console.error("Socket connection failed during init:",e)}}}else if("loading"!==u){let e=localStorage.getItem("authToken");if(e){let t=await n.R2.getProfile();if(t.success){h(t.data);try{await c.A.connect(e)}catch(e){console.error("Socket connection failed during init:",e)}}else localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken")}}}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken")}finally{"loading"!==u&&d(!1)}},m=async(e,t)=>{try{let s=await n.R2.login({identifier:e,password:t});if(!s.success)return{success:!1,message:s.message};localStorage.setItem("authToken",s.data.token),localStorage.setItem("refreshToken",s.data.refreshToken),h(s.data.user);try{await c.A.connect(s.data.token)}catch(e){console.error("Socket connection failed:",e)}return{success:!0,message:s.message}}catch(e){var s,o;return console.error("Login error:",e),{success:!1,message:(null==(o=e.response)||null==(s=o.data)?void 0:s.message)||"Login failed. Please try again."}}},p=async e=>{try{let t=await n.R2.register(e);if(!t.success)return{success:!1,message:t.message};localStorage.setItem("authToken",t.data.token),localStorage.setItem("refreshToken",t.data.refreshToken),h(t.data.user);try{await c.A.connect(t.data.token)}catch(e){console.error("Socket connection failed:",e)}return{success:!0,message:t.message}}catch(e){var t,s;return console.error("Register error:",e),{success:!1,message:(null==(s=e.response)||null==(t=s.data)?void 0:t.message)||"Registration failed. Please try again."}}},f=async()=>{try{await n.R2.logout()}catch(e){console.error("Logout error:",e)}finally{h(null),localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),c.A.disconnect()}},y=async()=>{try{let e=await n.R2.getProfile();e.success&&h(e.data)}catch(e){console.error("Refresh auth error:",e),f()}};return(0,o.jsx)(r.Provider,{value:{user:s,isLoading:l,login:m,register:p,logout:f,refreshAuth:y,updateUser:e=>{h(e)}},children:t})}function l(){let e=(0,a.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(){let{user:e,isLoading:t}=l();return{user:e,isLoading:t,isAuthenticated:!!e&&!t}}},7621:(e,t,s)=>{s.d(t,{R2:()=>a,ej:()=>n,h2:()=>c});let o=s(5125).A.create({baseURL:"https://meetvault-production.up.railway.app/api",headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{{let t=localStorage.getItem("authToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),o.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===401&&(localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),window.location.href="/auth/login"),Promise.reject(e)});let a={register:async e=>(await o.post("/auth/register",e)).data,login:async e=>(await o.post("/auth/login",e)).data,refreshToken:async e=>(await o.post("/auth/refresh-token",{refreshToken:e})).data,getProfile:async()=>(await o.get("/auth/profile")).data,updateProfile:async e=>(await o.put("/auth/profile",e)).data,changePassword:async(e,t)=>(await o.put("/auth/change-password",{currentPassword:e,newPassword:t})).data,logout:async()=>(await o.post("/auth/logout")).data},n={createMeeting:async e=>(await o.post("/meetings",e)).data,getMeeting:async e=>(await o.get("/meetings/".concat(e))).data,joinMeeting:async(e,t)=>(await o.post("/meetings/".concat(e,"/join"),t||{})).data,leaveMeeting:async e=>(await o.post("/meetings/".concat(e,"/leave"))).data,startMeeting:async e=>(await o.post("/meetings/".concat(e,"/start"))).data,endMeeting:async e=>(await o.post("/meetings/".concat(e,"/end"))).data,getUserMeetings:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all";return(await o.get("/meetings/my-meetings",{params:{page:e,limit:t,status:s}})).data},getActiveMeetings:async()=>(await o.get("/meetings/active")).data,updateMeetingSettings:async(e,t)=>(await o.put("/meetings/".concat(e,"/settings"),t)).data},c={sendMessage:async(e,t)=>(await o.post("/chat/meetings/".concat(e,"/messages"),t)).data,getMessages:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return(await o.get("/chat/meetings/".concat(e,"/messages"),{params:{page:t,limit:s}})).data},editMessage:async(e,t)=>(await o.put("/chat/messages/".concat(e),{content:t})).data,deleteMessage:async e=>(await o.delete("/chat/messages/".concat(e))).data,addReaction:async(e,t)=>(await o.post("/chat/messages/".concat(e,"/reactions"),{emoji:t})).data,removeReaction:async(e,t)=>(await o.delete("/chat/messages/".concat(e,"/reactions"),{data:{emoji:t}})).data,markAsRead:async e=>(await o.post("/chat/messages/".concat(e,"/read"))).data,getUnreadCount:async e=>(await o.get("/chat/meetings/".concat(e,"/unread-count"))).data}}}]);